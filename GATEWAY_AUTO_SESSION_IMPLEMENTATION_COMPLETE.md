# ‚úÖ Gateway: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∞

**–î–∞—Ç–∞:** 2026-02-09
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2026-02-09 (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞)
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** Gateway + Agent Runtime
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

---

## –û–±–∑–æ—Ä

Gateway —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–π. –¢–µ–ø–µ—Ä—å –ø–æ–ª–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ **IDE ‚Üí Gateway ‚Üí Agent Runtime** –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π –±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ `POST /sessions`.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

IDE                    Gateway                  Agent Runtime
 ‚îÇ                        ‚îÇ                           ‚îÇ
 ‚îÇ  WebSocket /ws/new_*   ‚îÇ                           ‚îÇ
 ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                           ‚îÇ
 ‚îÇ                        ‚îÇ                           ‚îÇ
 ‚îÇ  user_message          ‚îÇ                           ‚îÇ
 ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                           ‚îÇ
 ‚îÇ                        ‚îÇ  POST /agent/message/stream‚îÇ
 ‚îÇ                        ‚îÇ  (–ë–ï–ó session_id)         ‚îÇ
 ‚îÇ                        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
 ‚îÇ                        ‚îÇ                           ‚îÇ
 ‚îÇ                        ‚îÇ  SSE: session_info        ‚îÇ
 ‚îÇ                        ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
 ‚îÇ  session_info          ‚îÇ                           ‚îÇ
 ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                           ‚îÇ
 ‚îÇ                        ‚îÇ                           ‚îÇ
 ‚îÇ  user_message          ‚îÇ                           ‚îÇ
 ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                           ‚îÇ
 ‚îÇ                        ‚îÇ  POST /agent/message/stream‚îÇ
 ‚îÇ                        ‚îÇ  (–° session_id)           ‚îÇ
 ‚îÇ                        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
```

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. WebSocket Endpoint
**–§–∞–π–ª:** [`codelab-ai-service/gateway/app/api/v1/endpoints.py`](codelab-ai-service/gateway/app/api/v1/endpoints.py)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ session_id —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `new_`
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —Å–µ—Å—Å–∏–∏ (–≤—Ä–µ–º–µ–Ω–Ω–∞—è/—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è)
- ‚úÖ –ü–µ—Ä–µ–¥–∞–µ—Ç —Ñ–ª–∞–≥ `is_temp_session` –≤ WebSocketHandler
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è endpoint

**–ö–ª—é—á–µ–≤–æ–π –∫–æ–¥:**
```python
is_temp_session = session_id.startswith("new_")
if is_temp_session:
    logger.info(f"[{session_id}] Temporary session ID detected")
await ws_handler.handle_connection(websocket, session_id, is_temp_session)
```

### 2. WebSocketHandler
**–§–∞–π–ª:** [`codelab-ai-service/gateway/app/services/websocket/websocket_handler.py`](codelab-ai-service/gateway/app/services/websocket/websocket_handler.py)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –ú–µ—Ç–æ–¥ `handle_connection()` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `is_temp_session`
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç session_id –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è `session_info`
- ‚úÖ –ú–µ—Ç–æ–¥ `_forward_to_agent()` —É—Å–ª–æ–≤–Ω–æ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç payload
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π session_id –∏–∑ SSE stream

**–ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞:**
```python
# –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ payload
if is_temp_session:
    payload = {"message": ide_msg}  # –ë–ï–ó session_id
else:
    payload = {"session_id": session_id, "message": ide_msg}

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ session_id
new_session_id = await self._forward_to_agent(...)
if new_session_id and new_session_id != actual_session_id:
    actual_session_id = new_session_id
    is_temp_session = False
```

### 3. SSEStreamHandler
**–§–∞–π–ª:** [`codelab-ai-service/gateway/app/services/websocket/sse_stream_handler.py`](codelab-ai-service/gateway/app/services/websocket/sse_stream_handler.py)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –ú–µ—Ç–æ–¥ `process_stream()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π session_id
- ‚úÖ –ú–µ—Ç–æ–¥ `_forward_data()` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `session_info` —á–∞–Ω–∫
- ‚úÖ –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç `session_info` –≤ IDE —á–µ—Ä–µ–∑ WebSocket
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è `session_info`

**–ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞:**
```python
if msg_type == "session_info":
    new_session_id = data.get('session_id')
    logger.info(f"üÜî Received session_info: {new_session_id}")
    await websocket.send_json(filtered_data)  # –ü—Ä–æ–∫—Å–∏—Ä—É–µ–º
    return new_session_id  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è | –°—Ç—Ä–æ–∫–∏ |
|------|-----------|--------|
| [`app/api/v1/endpoints.py`](codelab-ai-service/gateway/app/api/v1/endpoints.py) | –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö session_id | ~15 |
| [`app/services/websocket/websocket_handler.py`](codelab-ai-service/gateway/app/services/websocket/websocket_handler.py) | –£—Å–ª–æ–≤–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ session_id, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ID | ~50 |
| [`app/services/websocket/sse_stream_handler.py`](codelab-ai-service/gateway/app/services/websocket/sse_stream_handler.py) | –û–±—Ä–∞–±–æ—Ç–∫–∞ session_info —á–∞–Ω–∫–∞ | ~30 |

**–í—Å–µ–≥–æ:** 3 —Ñ–∞–π–ª–∞, ~95 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

## –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| [`GATEWAY_AUTO_SESSION_SUPPORT.md`](codelab-ai-service/gateway/GATEWAY_AUTO_SESSION_SUPPORT.md) | –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ |
| [`test_auto_session.py`](codelab-ai-service/gateway/test_auto_session.py) | –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ |
| [`CHANGELOG.md`](codelab-ai-service/gateway/CHANGELOG.md) | –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π |

## –ü—Ä–æ—Ç–æ–∫–æ–ª —Ä–∞–±–æ—Ç—ã

### –ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è (—Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º ID)

```
1. IDE –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π ID: new_1234567890
2. IDE –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç WebSocket: /ws/new_1234567890
3. Gateway –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç: is_temp_session = True
4. IDE –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç user_message
5. Gateway ‚Üí Agent Runtime: POST /agent/message/stream –ë–ï–ó session_id
6. Agent Runtime —Å–æ–∑–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç session_info
7. Gateway –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç session_info ‚Üí IDE
8. Gateway –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π session_id: new_1234567890 ‚Üí abc-123
9. IDE —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π session_id: abc-123
10. IDE –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
11. Gateway ‚Üí Agent Runtime: POST /agent/message/stream –° session_id=abc-123
```

### –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å–µ—Å—Å–∏—è

```
1. IDE –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç WebSocket: /ws/abc-123
2. Gateway –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç: is_temp_session = False
3. IDE –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç user_message
4. Gateway ‚Üí Agent Runtime: POST /agent/message/stream –° session_id=abc-123
5. Agent Runtime –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç session_info
6. Gateway –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è
```
INFO: [new_1234567890] Temporary session ID detected, will create new session
INFO: [new_1234567890] WebSocket connected (temp=True)
INFO: [new_1234567890] Temporary session - NOT sending session_id to Agent Runtime
INFO: [new_1234567890] üÜî Received session_info chunk: session_id=abc-123
INFO: [new_1234567890] Session ID updated: new_1234567890 -> abc-123
INFO: [abc-123] Sending session_id to Agent Runtime
```

### –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å–µ—Å—Å–∏—è
```
INFO: [abc-123] WebSocket connected (temp=False)
INFO: [abc-123] Sending session_id to Agent Runtime
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

**–§–∞–π–ª:** [`test_auto_session.py`](codelab-ai-service/gateway/test_auto_session.py)

**–ó–∞–ø—É—Å–∫:**
```bash
cd codelab-ai-service/gateway
python test_auto_session.py ws://localhost:8001/api/v1
```

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º ID
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ session_info —á–∞–Ω–∫–∞
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ session_info
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–µ—Å—Å–∏–∏
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ session_info –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–µ—Å—Å–∏–π

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¢–µ—Å—Ç 1: –ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è**
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ WebSocket
wscat -c ws://localhost:8001/api/v1/ws/new_1234567890

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
{"type":"user_message","role":"user","content":"–ü—Ä–∏–≤–µ—Ç!"}

# –û–∂–∏–¥–∞—Ç—å session_info
{"type":"session_info","session_id":"abc-123","is_final":false}
```

**–¢–µ—Å—Ç 2: –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å–µ—Å—Å–∏—è**
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ WebSocket
wscat -c ws://localhost:8001/api/v1/ws/abc-123

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
{"type":"user_message","role":"user","content":"–ü—Ä–∏–≤–µ—Ç!"}

# session_info –ù–ï –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–π—Ç–∏
```

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

‚úÖ **100% –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**

–í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª–∏–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ session_id, –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```python
# –°—Ç–∞—Ä—ã–π –∫–æ–¥ - –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
websocket = await connect("ws://gateway/ws/abc-123")
await websocket.send(user_message)
```

–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ** –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö ID —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `new_`.

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

### ‚úÖ IDE
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ ID (`new_*`)
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `session_info` —á–∞–Ω–∫
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π session_id
- **–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

### ‚úÖ Agent Runtime
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ë–ï–ó session_id
- –°–æ–∑–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `session_info` —á–∞–Ω–∫
- **–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ

### ‚úÖ Gateway
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ session_id
- –£—Å–ª–æ–≤–Ω–æ –ø–µ—Ä–µ–¥–∞–µ—Ç session_id
- –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç `session_info` —á–∞–Ω–∫
- **–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (—Ç–µ–∫—É—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç)

## –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –í–µ—Ä—Å–∏—è |
|-----------|--------|--------|
| **IDE** | ‚úÖ –ì–æ—Ç–æ–≤–æ | Latest |
| **Agent Runtime** | ‚úÖ –†–∞–∑–≤–µ—Ä–Ω—É—Ç–æ | Production |
| **Gateway** | ‚úÖ –ì–æ—Ç–æ–≤–æ | Unreleased |

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Gateway
```bash
# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑
cd codelab-ai-service/gateway
docker build -t gateway:auto-session .

# –û–±–Ω–æ–≤–∏—Ç—å –≤ docker-compose –∏–ª–∏ Kubernetes
docker-compose up -d gateway
# –∏–ª–∏
kubectl rollout restart deployment/gateway
```

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Gateway
docker logs -f gateway | grep "session_info"
docker logs -f gateway | grep "Temporary session"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
curl http://localhost:8001/health
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
cd codelab-ai-service/gateway
python test_auto_session.py ws://localhost:8001/api/v1

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ IDE
# 1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥
# 2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ IDE –Ω–∞ –Ω–∞–ª–∏—á–∏–µ session_info
# 4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π session_id
```

### 4. Production Rollout
1. ‚úÖ –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤ staging –æ–∫—Ä—É–∂–µ–Ω–∏–∏
2. ‚è≥ –ü—Ä–æ–≤–µ—Å—Ç–∏ smoke —Ç–µ—Å—Ç—ã
3. ‚è≥ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫ (24 —á–∞—Å–∞)
4. ‚è≥ –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤ production
5. ‚è≥ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π rollout (canary deployment)

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- üìÑ [`AUTO_SESSION_CREATION_PROTOCOL.md`](codelab_ide/doc/AUTO_SESSION_CREATION_PROTOCOL.md) - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
- üìÑ [`GATEWAY_AUTO_SESSION_SUPPORT.md`](codelab-ai-service/gateway/GATEWAY_AUTO_SESSION_SUPPORT.md) - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Gateway
- üìÑ [`CHANGELOG.md`](codelab-ai-service/gateway/CHANGELOG.md) - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ö–æ–¥
- üíª [`endpoints.py`](codelab-ai-service/gateway/app/api/v1/endpoints.py) - WebSocket endpoint
- üíª [`websocket_handler.py`](codelab-ai-service/gateway/app/services/websocket/websocket_handler.py) - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ WebSocket
- üíª [`sse_stream_handler.py`](codelab-ai-service/gateway/app/services/websocket/sse_stream_handler.py) - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ SSE stream

### –¢–µ—Å—Ç—ã
- üß™ [`test_auto_session.py`](codelab-ai-service/gateway/test_auto_session.py) - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
- ‚úÖ WebSocket –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ session_id
- ‚úÖ Gateway –ù–ï –ø–µ—Ä–µ–¥–∞–µ—Ç session_id –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- ‚úÖ Gateway –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç session_info —á–∞–Ω–∫
- ‚úÖ Gateway –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π session_id
- ‚úÖ Gateway –ø–µ—Ä–µ–¥–∞–µ—Ç session_id –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ
- ‚úÖ –ö–æ–¥ –ø–æ–∫—Ä—ã—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω CHANGELOG
- ‚úÖ –ù–µ—Ç breaking changes

## –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| –ü—Ä–æ–±–ª–µ–º—ã —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º session_id | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω—è—è | –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ç–µ—Å—Ç—ã |
| –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ–º session_info | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∞—è | –¢–µ—Å—Ç—ã, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |
| –†–µ–≥—Ä–µ—Å—Å–∏—è –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ | –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∞—è | –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å, —Ç–µ—Å—Ç—ã |
| –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é | –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è | –ù–∏–∑–∫–∞—è | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ |

## üêõ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (2026-02-09)

### –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±—ã–ª–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ Agent Runtime:
```
ImportError: attempted relative import beyond top-level package
```

### –ü—Ä–∏—á–∏–Ω–∞
–í —Ñ–∞–π–ª–µ [`message_processor.py`](codelab-ai-service/agent-runtime/app/domain/services/message_processor.py:171) –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–æ—á–µ–∫:
```python
from ....models.schemas import StreamChunk  # ‚ùå 4 —Ç–æ—á–∫–∏ - –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –ø–∞–∫–µ—Ç–∞
```

### –†–µ—à–µ–Ω–∏–µ
–£–¥–∞–ª–µ–Ω –∏–∑–±—ã—Ç–æ—á–Ω—ã–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç, —Ç–∞–∫ –∫–∞–∫ `StreamChunk` —É–∂–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞:
```python
from ...models.schemas import StreamChunk  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç –≤ —Å—Ç—Ä–æ–∫–µ 15
```

### –°—Ç–∞—Ç—É—Å
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 2026-02-09
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** Agent Runtime –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω, –æ—à–∏–±–∫–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ:** –°–º. [`IMPORT_ERROR_FIX_REPORT.md`](IMPORT_ERROR_FIX_REPORT.md)

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

‚úÖ **Gateway –∏ Agent Runtime —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–π**

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã (IDE, Gateway, Agent Runtime) —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –Ω–æ–≤—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞
- ‚úÖ –û–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∞ —Ç–µ—Å—Ç–∞–º–∏
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ –ì–æ—Ç–æ–≤–∞ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Gateway –∏ Agent Runtime –≤ staging –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

---

**–ê–≤—Ç–æ—Ä:** Roo (AI Assistant)
**–î–∞—Ç–∞:** 2026-02-09
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2026-02-09 (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ImportError)
**–í–µ—Ä—Å–∏—è:** 1.1
