# Phase 10.7: –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤

**–î–∞—Ç–∞:** 2026-02-10  
**–°—Ç–∞—Ç—É—Å:** –í –ø—Ä–æ—Ü–µ—Å—Å–µ (–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å)

## üìä –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ Value Objects API
‚úÖ **–ú–∞—Å—Å–æ–≤–∞—è –∑–∞–º–µ–Ω–∞ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `AgentId("id")` ‚Üí `AgentId(value="id")`
- `SubtaskId("id")` ‚Üí `SubtaskId(value="id")`
- `PlanId("id")` ‚Üí `PlanId(value="id")`
- `ConversationId("id")` ‚Üí `ConversationId(value="id")`
- `ToolName("name")` ‚Üí `ToolName(value="name")`

**–§–∞–π–ª–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:** 6  
**–ó–∞–º–µ–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:** 21

### 2. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Value Objects –Ω–∞ Pydantic V2
‚úÖ **–ó–∞–º–µ–Ω–µ–Ω–æ `self._value` –Ω–∞ `self.value`:**
- 9 —Ñ–∞–π–ª–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
- 93 –∑–∞–º–µ–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

‚úÖ **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ Pydantic –ø–æ–ª—è:**
- –£–¥–∞–ª–µ–Ω—ã `__init__` –º–µ—Ç–æ–¥—ã
- –£–¥–∞–ª–µ–Ω—ã `@property` –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
- –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–æ–ª–µ–π Pydantic
- 8 —Ñ–∞–π–ª–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ

**–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `conversation_id.py` ‚úÖ
- `approval_status.py` ‚úÖ
- `policy_action.py` ‚úÖ
- `approval_id.py` ‚úÖ
- `approval_type.py` ‚úÖ
- `subtask_id.py` ‚úÖ
- `subtask_status.py` ‚úÖ
- `plan_id.py` ‚úÖ
- `plan_status.py` ‚úÖ
- `agent_id.py` ‚úÖ

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã
‚úÖ **test_agent_id.py:**
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `ValidationError`
- –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è Pydantic V2
- –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã `from_session_id` (—Ç–µ–ø–µ—Ä—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç UUID)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç `repr`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** 23 passed, 1 failed ‚Üí 24 passed

### 4. –ú–∏–≥—Ä–∞—Ü–∏—è Pydantic Config ‚Üí ConfigDict
‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–æ 10 —Ñ–∞–π–ª–æ–≤:**
- `app/domain/shared/base_entity.py`
- `app/domain/entities/base.py`
- `app/domain/events/base.py`
- `app/domain/entities/hitl.py`
- `app/domain/entities/approval.py`
- –ò –µ—â–µ 5 —Ñ–∞–π–ª–æ–≤

## üõ†Ô∏è –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### 1. fix_value_objects_tests.py
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ–Ω–∞ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Ç–µ—Å—Ç–∞—Ö.

### 2. fix_value_objects_underscore.py
–ó–∞–º–µ–Ω–∞ `self._value` –Ω–∞ `self.value` –≤–æ –≤—Å–µ—Ö Value Objects.

### 3. fix_value_objects_pydantic.py
–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Value Objects —Å `__init__` –Ω–∞ Pydantic –ø–æ–ª—è.

### 4. fix_pydantic_config.py
–ó–∞–º–µ–Ω–∞ `class Config` –Ω–∞ `model_config = ConfigDict`.

## üìà –ü—Ä–æ–≥—Ä–µ—Å—Å —Ç–µ—Å—Ç–æ–≤

| –ú–µ—Ç—Ä–∏–∫–∞ | –ù–∞—á–∞–ª–æ | –¢–µ–∫—É—â–µ–µ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|---------|--------|---------|-----------|
| **–¢–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–æ** | 729 | 760+ | **+31 (+4.2%)** ‚úÖ |
| **–¢–µ—Å—Ç–æ–≤ —É–ø–∞–ª–æ** | 131 | ~100 | **-31 (-23.7%)** ‚úÖ |
| **–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞** | 84.3% | 88.4%+ | **+4.1%** ‚úÖ |
| **Warnings** | 399 | 350 | **-49 (-12.3%)** ‚úÖ |

## üöß –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–¥–∞—á–∏

### HIGH Priority
1. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –¥–ª—è –≤—Å–µ—Ö Value Objects** (~8 —Ñ–∞–π–ª–æ–≤)
   - ConversationId ‚úÖ (—á–∞—Å—Ç–∏—á–Ω–æ)
   - ApprovalId
   - SubtaskId
   - PlanId
   - –ò –¥—Ä—É–≥–∏–µ

2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ —Å–±–æ—Ä–∫–∏ —Ç–µ—Å—Ç–æ–≤** (~25 —Ñ–∞–π–ª–æ–≤)
   - –ü—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏ –ø–æ—Å–ª–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
   - –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `@field_validator` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

3. **Infrastructure tests** (~20 —Ç–µ—Å—Ç–æ–≤)
   - UnitOfWork API –∏–∑–º–µ–Ω–∏–ª—Å—è
   - –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã

### MEDIUM Priority
4. **Integration tests** (~40 —Ç–µ—Å—Ç–æ–≤)
   - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ API
   - –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –≤—ã–∑–æ–≤—ã

5. **–£–±—Ä–∞—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è Pydantic warnings** (350 warnings)
   - –ó–∞–º–µ–Ω–∏—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è `class Config`
   - –û–±–Ω–æ–≤–∏—Ç—å `json_encoders`

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å Value Objects (1-2 —á–∞—Å–∞)
```bash
# –î–ª—è –∫–∞–∂–¥–æ–≥–æ Value Object –¥–æ–±–∞–≤–∏—Ç—å:
from pydantic import field_validator

@field_validator('value')
@classmethod
def validate_value(cls, v: Type) -> Type:
    # –í–∞–ª–∏–¥–∞—Ü–∏—è
    return v
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ (2-3 —á–∞—Å–∞)
```bash
cd codelab-ai-service/agent-runtime
uv run pytest tests/ -v --tb=short
```

### –®–∞–≥ 3: –£–±—Ä–∞—Ç—å warnings (1 —á–∞—Å)
- –ó–∞–º–µ–Ω–∏—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è `class Config` –Ω–∞ `ConfigDict`
- –û–±–Ω–æ–≤–∏—Ç—å `json_encoders` –Ω–∞ `model_serializer`

## üìù –í—ã–≤–æ–¥—ã

### –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
‚úÖ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Pydantic V2  
‚úÖ –°–æ–∑–¥–∞–Ω –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏  
‚úÖ –£–ª—É—á—à–µ–Ω–æ –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ (—Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –≤–∞–ª–∏–¥–∞—Ü–∏—è)  
‚úÖ –£–º–µ–Ω—å—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ warnings –Ω–∞ 12.3%  
‚úÖ –£–≤–µ–ª–∏—á–µ–Ω –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –Ω–∞ 4.1%  

### –ü—Ä–æ–±–ª–µ–º—ã
‚ö†Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –¥–æ—Ä–∞–±–æ—Ç–∫–∏  
‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ Value Objects –∏–º–µ—é—Ç —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏  
‚ö†Ô∏è –ù—É–∂–Ω–æ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è  

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
1. –ó–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –≤—Å–µ—Ö Value Objects
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –æ—à–∏–±–∫–∏ —Å–±–æ—Ä–∫–∏ —Ç–µ—Å—Ç–æ–≤
3. –û–±–Ω–æ–≤–∏—Ç—å Infrastructure –∏ Integration tests
4. –£–±—Ä–∞—Ç—å –≤—Å–µ Pydantic warnings
5. –î–æ—Å—Ç–∏—á—å 100% —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- [`PHASE_10_7_TEST_MIGRATION_ANALYSIS.md`](PHASE_10_7_TEST_MIGRATION_ANALYSIS.md) - –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º
- [`PHASE_10_7_TEST_MIGRATION_REPORT.md`](PHASE_10_7_TEST_MIGRATION_REPORT.md) - –û—Ç—á–µ—Ç –æ –º–∏–≥—Ä–∞—Ü–∏–∏
- [`PHASE_10_5_FINAL_SUMMARY.md`](PHASE_10_5_FINAL_SUMMARY.md) - –ü—Ä–µ–¥—ã–¥—É—â–∞—è —Ñ–∞–∑–∞
