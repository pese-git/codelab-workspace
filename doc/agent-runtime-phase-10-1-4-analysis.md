# üìä –ê–Ω–∞–ª–∏–∑ –§–∞–∑—ã 10.1.4: –ú–∏–≥—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö Domain Services

**–î–∞—Ç–∞:** 6 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–°—Ç–∞—Ç—É—Å:** üîç –ê–Ω–∞–ª–∏–∑  

---

## üéØ –¶–µ–ª—å

–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è domain services –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ legacy services.

---

## üìã –°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏

### 1. **message_processor.py** (410 —Å—Ç—Ä–æ–∫)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- ‚úÖ `SessionManagementService` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `ConversationServiceAdapter`
- ‚úÖ `AgentOrchestrationService` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `AgentOrchestrationAdapter`
- ‚ùå –ü—Ä—è–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã legacy entities: `AgentType`

**–î–µ–π—Å—Ç–≤–∏—è:**
- –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–¥–∞–ø—Ç–µ—Ä–æ–≤
- –ó–∞–º–µ–Ω–∏—Ç—å `AgentType` –∏–∑ legacy –Ω–∞ –Ω–æ–≤—ã–π
- –û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**–û—Ü–µ–Ω–∫–∞:** 30 –º–∏–Ω—É—Ç

---

### 2. **agent_switcher.py** (189 —Å—Ç—Ä–æ–∫)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- ‚úÖ `AgentOrchestrationService` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `AgentOrchestrationAdapter`
- ‚ùå –ü—Ä—è–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã legacy entities: `AgentType`

**–î–µ–π—Å—Ç–≤–∏—è:**
- –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–¥–∞–ø—Ç–µ—Ä–∞
- –ó–∞–º–µ–Ω–∏—Ç—å `AgentType` –∏–∑ legacy –Ω–∞ –Ω–æ–≤—ã–π

**–û—Ü–µ–Ω–∫–∞:** 20 –º–∏–Ω—É—Ç

---

### 3. **tool_result_handler.py** (316 —Å—Ç—Ä–æ–∫)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- ‚úÖ `SessionManagementService` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `ConversationServiceAdapter`
- ‚úÖ `AgentOrchestrationService` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `AgentOrchestrationAdapter`
- ‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ApprovalManager` –∏ `PlanRepository` (legacy)

**–î–µ–π—Å—Ç–≤–∏—è:**
- –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–¥–∞–ø—Ç–µ—Ä–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å `ApprovalManager`

**–û—Ü–µ–Ω–∫–∞:** 30 –º–∏–Ω—É—Ç

---

### 4. **hitl_decision_handler.py** (230 —Å—Ç—Ä–æ–∫)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- ‚úÖ `SessionManagementService` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `ConversationServiceAdapter`
- ‚úÖ `MessageProcessor` ‚Üí –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ApprovalManager` (legacy)

**–î–µ–π—Å—Ç–≤–∏—è:**
- –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–¥–∞–ø—Ç–µ—Ä–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å `ApprovalManager`

**–û—Ü–µ–Ω–∫–∞:** 20 –º–∏–Ω—É—Ç

---

### 5. **plan_approval_handler.py** (379 —Å—Ç—Ä–æ–∫)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- ‚úÖ `SessionManagementService` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `ConversationServiceAdapter`
- ‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `FSMOrchestrator`, `ExecutionCoordinator`, `PlanRepository` (legacy)

**–î–µ–π—Å—Ç–≤–∏—è:**
- –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–¥–∞–ø—Ç–µ—Ä–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å FSM –∏ Execution —Å–∏—Å—Ç–µ–º–∞–º–∏

**–û—Ü–µ–Ω–∫–∞:** 40 –º–∏–Ω—É—Ç

---

### 6. **subtask_executor.py** (500 —Å—Ç—Ä–æ–∫)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- ‚úÖ `SessionManagementService` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `ConversationServiceAdapter`
- ‚ùå –ü—Ä—è–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã legacy entities: `Plan`, `Subtask`, `SubtaskStatus`, `AgentType`
- ‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `PlanRepository` (legacy)

**–î–µ–π—Å—Ç–≤–∏—è:**
- –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö entities
- –ó–∞–º–µ–Ω–∏—Ç—å `Plan` ‚Üí `ExecutionPlan`
- –ó–∞–º–µ–Ω–∏—Ç—å `Subtask` ‚Üí –Ω–æ–≤—ã–π `Subtask`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Value Objects –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤

**–û—Ü–µ–Ω–∫–∞:** 45 –º–∏–Ω—É—Ç

---

### 7. **dependency_resolver.py** (293 —Å—Ç—Ä–æ–∫–∏)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- ‚ùå –ü—Ä—è–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã legacy entities: `Plan`, `Subtask`, `SubtaskStatus`

**–î–µ–π—Å—Ç–≤–∏—è:**
- –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö entities
- –ó–∞–º–µ–Ω–∏—Ç—å `Plan` ‚Üí `ExecutionPlan`
- –ó–∞–º–µ–Ω–∏—Ç—å `Subtask` ‚Üí –Ω–æ–≤—ã–π `Subtask`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Value Objects –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤

**–û—Ü–µ–Ω–∫–∞:** 30 –º–∏–Ω—É—Ç

---

## üîÑ –ü–æ—Ä—è–¥–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–∏

### –ì—Ä—É–ø–ø–∞ 1: –ü—Ä–æ—Å—Ç—ã–µ —Å–µ—Ä–≤–∏—Å—ã (—Ç–æ–ª—å–∫–æ –∞–¥–∞–ø—Ç–µ—Ä—ã)
1. **agent_switcher.py** - 20 –º–∏–Ω
2. **message_processor.py** - 30 –º–∏–Ω
3. **hitl_decision_handler.py** - 20 –º–∏–Ω

**–ò—Ç–æ–≥–æ:** 1 —á–∞—Å 10 –º–∏–Ω—É—Ç

### –ì—Ä—É–ø–ø–∞ 2: –°–µ—Ä–≤–∏—Å—ã —Å ApprovalManager
4. **tool_result_handler.py** - 30 –º–∏–Ω

**–ò—Ç–æ–≥–æ:** 30 –º–∏–Ω—É—Ç

### –ì—Ä—É–ø–ø–∞ 3: –°–µ—Ä–≤–∏—Å—ã —Å Plan entities
5. **dependency_resolver.py** - 30 –º–∏–Ω
6. **subtask_executor.py** - 45 –º–∏–Ω
7. **plan_approval_handler.py** - 40 –º–∏–Ω

**–ò—Ç–æ–≥–æ:** 1 —á–∞—Å 55 –º–∏–Ω—É—Ç

---

## üìä –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –í—Ä–µ–º—è |
|-----------|-------|
| –ú–∏–≥—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ | 3 —á–∞—Å–∞ 35 –º–∏–Ω—É—Ç |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 1 —á–∞—Å |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | 25 –º–∏–Ω—É—Ç |
| **–ò—Ç–æ–≥–æ** | **5 —á–∞—Å–æ–≤** |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –±—ã–ª–∞ 3 —á–∞—Å–∞, –Ω–æ –ø–æ—Å–ª–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤–∏–¥–Ω–æ, —á—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–∑-–∑–∞:
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Plan entities
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å ApprovalManager
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

---

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. **–ê–¥–∞–ø—Ç–µ—Ä—ã —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã**
- ‚úÖ `ConversationServiceAdapter` (–§–∞–∑–∞ 10.1.1)
- ‚úÖ `AgentOrchestrationAdapter` (–§–∞–∑–∞ 10.1.2)
- ‚úÖ `ExecutionEngineAdapter` (–§–∞–∑–∞ 10.1.3)

### 2. **Legacy entities –≤—Å–µ –µ—â–µ –Ω—É–∂–Ω—ã**
–°–ª–µ–¥—É—é—â–∏–µ legacy entities –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö:
- `Plan`, `Subtask` - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ Infrastructure Layer
- `ApprovalManager` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Application Layer
- `FSMOrchestrator` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Application Layer

**–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±—É–¥—É—Ç –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –§–∞–∑–∞—Ö 10.2 –∏ 10.3

### 3. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä—ã.

---

## üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã
–ó–∞–º–µ–Ω–∏—Ç—å –ø—Ä—è–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã legacy services –Ω–∞ –∞–¥–∞–ø—Ç–µ—Ä—ã:
```python
# –ë—ã–ª–æ:
from .session_management import SessionManagementService
from .agent_orchestration import AgentOrchestrationService

# –°—Ç–∞–Ω–µ—Ç:
from ..adapters.conversation_service_adapter import ConversationServiceAdapter as SessionManagementService
from ..adapters.agent_orchestration_adapter import AgentOrchestrationAdapter as AgentOrchestrationService
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø—ã
–ó–∞–º–µ–Ω–∏—Ç—å legacy entities –Ω–∞ –Ω–æ–≤—ã–µ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ:
```python
# –ë—ã–ª–æ:
from ..entities.agent_context import AgentType

# –°—Ç–∞–Ω–µ—Ç:
from ..agent_context.value_objects.agent_capabilities import AgentType
```

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç
- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω
2. ‚è≥ –ù–∞—á–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ì—Ä—É–ø–ø—ã 1 (agent_switcher, message_processor, hitl_decision_handler)
3. ‚è≥ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –ì—Ä—É–ø–ø–æ–π 2 (tool_result_handler)
4. ‚è≥ –ó–∞–≤–µ—Ä—à–∏—Ç—å –ì—Ä—É–ø–ø–æ–π 3 (dependency_resolver, subtask_executor, plan_approval_handler)
5. ‚è≥ –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã
6. ‚è≥ –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 6 —Ñ–µ–≤—Ä–∞–ª—è 2026, 14:57 UTC+3
