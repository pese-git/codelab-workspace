# üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ Infrastructure Layer - –§–∞–∑–∞ 10.2

**–î–∞—Ç–∞:** 6 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–ê–≤—Ç–æ—Ä:** Agent Runtime Team  
**–°—Ç–∞—Ç—É—Å:** üìã –ì–æ—Ç–æ–≤–∞ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é

---

## üéØ –¶–µ–ª—å –§–∞–∑—ã 10.2

–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Infrastructure Layer –Ω–∞ –Ω–æ–≤—É—é DDD-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, —Å–æ–∑–¥–∞–≤ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `ExecutionPlan` entity –∏ –æ–±–Ω–æ–≤–∏–≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

---

## üìä –ö–æ–Ω—Ç–µ–∫—Å—Ç

### –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ (–§–∞–∑—ã 10.1.1-10.1.4)

‚úÖ **Domain Services:**
- `ConversationManagementService` + –∞–¥–∞–ø—Ç–µ—Ä
- `AgentCoordinationService` + –∞–¥–∞–ø—Ç–µ—Ä
- `ExecutionEngineAdapter` (–¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –≤ `PlanExecutionService`)

‚úÖ **Infrastructure (—á–∞—Å—Ç–∏—á–Ω–æ):**
- `ConversationMapper` - –¥–ª—è Conversation entity
- `AgentMapper` - –¥–ª—è Agent entity
- `ConversationRepositoryImpl` - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- `AgentRepositoryImpl` - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

‚úÖ **DI Container:**
- –û–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–¥–∞–ø—Ç–µ—Ä–æ–≤
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

### –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å

‚ùå **Infrastructure (ExecutionPlan):**
- `ExecutionPlanMapper` - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- `ExecutionPlanRepositoryImpl` - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- `PlanMapper` - —Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `PlanRepositoryImpl` - —Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

## üéØ –í—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –í–∞—Ä–∏–∞–Ω—Ç 3 (–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π)

### –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞

**–ü–æ—á–µ–º—É –Ω–µ –í–∞—Ä–∏–∞–Ω—Ç 1 (–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π)?**
- ‚ùå –ù–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç `PlanMapper` –∏ `PlanRepositoryImpl`
- ‚ùå –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å—Ç–∞—Ä—ã–º –∏ –Ω–æ–≤—ã–º –∫–æ–¥–æ–º
- ‚ùå –ü–æ—Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø–æ–∑–∂–µ

**–ü–æ—á–µ–º—É –Ω–µ –í–∞—Ä–∏–∞–Ω—Ç 2 (–ü–æ–ª–Ω—ã–π)?**
- ‚ùå –í–∫–ª—é—á–∞–µ—Ç deprecation legacy –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚ùå –≠—Ç–æ –∑–∞–¥–∞—á–∞ –§–∞–∑—ã 10.4 (Legacy Code Removal)
- ‚ùå –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ 1.5 —á–∞—Å–∞ –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

**–ü–æ—á–µ–º—É –í–∞—Ä–∏–∞–Ω—Ç 3 (–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π)?** ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- ‚úÖ –û—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç cleanup –¥–æ –§–∞–∑—ã 10.4
- ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏/—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (7 —á–∞—Å–æ–≤)
- ‚úÖ –§–æ–∫—É—Å –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏, –∞ –Ω–µ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–¥–∞

---

## üìã –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏

### 1. ExecutionPlanMapper (–Ω–æ–≤—ã–π) - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å mapper –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É `ExecutionPlan` entity –∏ `PlanModel`.

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `ExecutionPlan` entity (domain)
- `PlanModel` (database)

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –ú–µ—Ç–æ–¥—ã `to_entity()` –∏ `to_model()`

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Value Objects: `PlanId`, `SubtaskId`, `ConversationId`, `PlanStatus`
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç `Subtask` entities
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- Pydantic –≤–∞–ª–∏–¥–∞—Ü–∏—è
- JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è metadata

**–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**
```python
class ExecutionPlanMapper:
    async def to_entity(
        self,
        model: PlanModel,
        db: AsyncSession
    ) -> ExecutionPlan:
        """Convert PlanModel to ExecutionPlan entity"""
        
    async def to_model(
        self,
        entity: ExecutionPlan,
        db: AsyncSession
    ) -> PlanModel:
        """Convert ExecutionPlan entity to PlanModel"""
```

**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞ (1.5—á –∫–æ–¥ + 0.5—á —Ç–µ—Å—Ç—ã)

---

### 2. ExecutionPlanRepositoryImpl (–Ω–æ–≤—ã–π) - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1

**–ó–∞–¥–∞—á–∞:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `ExecutionPlanRepository` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î.

**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç):**
```python
class ExecutionPlanRepository(Repository[ExecutionPlan, PlanId]):
    async def find_by_id(self, plan_id: PlanId) -> Optional[ExecutionPlan]
    async def find_by_conversation_id(self, conversation_id: ConversationId) -> List[ExecutionPlan]
    async def save(self, plan: ExecutionPlan) -> None
    async def delete(self, plan_id: PlanId) -> None
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ExecutionPlanMapper`
- –†–∞–±–æ—Ç–∞—Ç—å —Å `PlanModel` —á–µ—Ä–µ–∑ SQLAlchemy
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
- `find_active_by_conversation_id()` - –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–ª–∞–Ω—ã
- `find_by_status()` - –ø–ª–∞–Ω—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É
- `count_by_conversation_id()` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–ª–∞–Ω–æ–≤

**–û—Ü–µ–Ω–∫–∞:** 3 —á–∞—Å–∞ (2—á –∫–æ–¥ + 1—á —Ç–µ—Å—Ç—ã)

---

### 3. PlanMapper (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ) - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2

**–ó–∞–¥–∞—á–∞:** –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `PlanMapper` –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –Ω–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –†–∞–±–æ—Ç–∞–µ—Ç —Å legacy `Plan` entity
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã–µ ID
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Value Objects

**–¢—Ä–µ–±—É–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É `PlanId` Value Object
2. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é —Ç–∏–ø–æ–≤
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
4. –î–æ–±–∞–≤–∏—Ç—å type hints

**–ü—Ä–∏–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```python
# –ë—ã–ª–æ:
plan = Plan(
    id=plan_model.id,  # str
    session_id=plan_model.session_id,  # str
    ...
)

# –°—Ç–∞–ª–æ:
plan = Plan(
    id=plan_model.id,  # str (—Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
    session_id=plan_model.session_id,  # str
    ...
)

# –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è PlanId:
def _convert_plan_id(self, value: Union[str, PlanId]) -> str:
    """Convert PlanId to string for database"""
    return value.value if isinstance(value, PlanId) else value
```

**–û—Ü–µ–Ω–∫–∞:** 1 —á–∞—Å (0.5—á –∫–æ–¥ + 0.5—á —Ç–µ—Å—Ç—ã)

---

### 4. PlanRepositoryImpl (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ) - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2

**–ó–∞–¥–∞—á–∞:** –û–±–Ω–æ–≤–∏—Ç—å `PlanRepositoryImpl` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ mapper.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –†–∞–±–æ—Ç–∞–µ—Ç —Å legacy `Plan` entity
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `PlanMapper`
- –ù–µ –∏–º–µ–µ—Ç snapshot –º–µ—Ç–æ–¥–æ–≤

**–¢—Ä–µ–±—É–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
1. –û–±–Ω–æ–≤–∏—Ç—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º `PlanMapper`
2. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã snapshot (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   - `save_snapshot(snapshot_id, snapshot)`
   - `get_snapshot(snapshot_id)`
3. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
4. –î–æ–±–∞–≤–∏—Ç—å type hints

**–ü—Ä–∏–º–µ—Ä snapshot –º–µ—Ç–æ–¥–æ–≤:**
```python
# Class-level —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–∫–∞–∫ –≤ ConversationRepositoryImpl)
_snapshots: Dict[str, Dict[str, Any]] = {}

async def save_snapshot(
    self,
    snapshot_id: str,
    snapshot: Dict[str, Any]
) -> None:
    """Save plan snapshot to in-memory storage"""
    PlanRepositoryImpl._snapshots[snapshot_id] = snapshot

async def get_snapshot(
    self,
    snapshot_id: str
) -> Optional[Dict[str, Any]]:
    """Get plan snapshot from in-memory storage"""
    return PlanRepositoryImpl._snapshots.get(snapshot_id)
```

**–û—Ü–µ–Ω–∫–∞:** 1 —á–∞—Å (0.5—á –∫–æ–¥ + 0.5—á —Ç–µ—Å—Ç—ã)

---

## üîÑ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

### –ü—Ä–∏–Ω—Ü–∏–ø—ã

1. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ—Å—Ç—å** - —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ, –Ω–µ –ª–æ–º–∞—è —Å—Ç–∞—Ä–æ–µ
2. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å—Ç–∞—Ä—ã–π –∏ –Ω–æ–≤—ã–π –∫–æ–¥ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–∫—Ä—ã—Ç —Ç–µ—Å—Ç–∞–º–∏
4. **–ò–∑–æ–ª—è—Ü–∏—è** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ infrastructure —Å–ª–æ–µ
5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É—é—Ç—Å—è

### –≠—Ç–∞–ø—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

#### –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ ExecutionPlanMapper (2—á)

**–®–∞–≥–∏:**
1. –ò–∑—É—á–∏—Ç—å `ExecutionPlan` entity –∏ `Subtask` entity
2. –ò–∑—É—á–∏—Ç—å `PlanModel` –∏ `SubtaskModel`
3. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `execution_plan_mapper.py`
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `to_entity()` –º–µ—Ç–æ–¥
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `to_model()` –º–µ—Ç–æ–¥
6. –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã (15+ —Ç–µ—Å—Ç–æ–≤)
7. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ Mapper —Å–æ–∑–¥–∞–Ω
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Value Objects
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö Subtask entities

#### –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ ExecutionPlanRepositoryImpl (3—á)

**–®–∞–≥–∏:**
1. –ò–∑—É—á–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `ExecutionPlanRepository`
2. –ò–∑—É—á–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ repository implementations
3. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `execution_plan_repository_impl.py`
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã (find_by_id, save, delete)
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã (find_by_conversation_id)
6. –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã (20+ —Ç–µ—Å—Ç–æ–≤)
7. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ Repository —Å–æ–∑–¥–∞–Ω
- ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

#### –≠—Ç–∞–ø 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ PlanMapper (1—á)

**–®–∞–≥–∏:**
1. –ò–∑—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π `PlanMapper`
2. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É `PlanId` Value Object
3. –î–æ–±–∞–≤–∏—Ç—å helper –º–µ—Ç–æ–¥—ã –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
4. –û–±–Ω–æ–≤–∏—Ç—å type hints
5. –û–±–Ω–æ–≤–∏—Ç—å/–¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã
6. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ Mapper –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PlanId –¥–æ–±–∞–≤–ª–µ–Ω–∞
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

#### –≠—Ç–∞–ø 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ PlanRepositoryImpl (1—á)

**–®–∞–≥–∏:**
1. –ò–∑—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π `PlanRepositoryImpl`
2. –û–±–Ω–æ–≤–∏—Ç—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º mapper
3. –î–æ–±–∞–≤–∏—Ç—å snapshot –º–µ—Ç–æ–¥—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
5. –û–±–Ω–æ–≤–∏—Ç—å/–¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã
6. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ Repository –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ Snapshot –º–µ—Ç–æ–¥—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º mapper

---

## üß™ –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### Unit —Ç–µ—Å—Ç—ã

**ExecutionPlanMapper (15+ —Ç–µ—Å—Ç–æ–≤):**
- ‚úÖ to_entity: –±–∞–∑–æ–≤–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
- ‚úÖ to_entity: —Å subtasks
- ‚úÖ to_entity: —Å metadata
- ‚úÖ to_entity: –≤—Å–µ —Å—Ç–∞—Ç—É—Å—ã
- ‚úÖ to_entity: –æ–±—Ä–∞–±–æ—Ç–∫–∞ None –∑–Ω–∞—á–µ–Ω–∏–π
- ‚úÖ to_model: –±–∞–∑–æ–≤–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
- ‚úÖ to_model: —Å subtasks
- ‚úÖ to_model: —Å metadata
- ‚úÖ to_model: Value Objects ‚Üí strings
- ‚úÖ Roundtrip: entity ‚Üí model ‚Üí entity

**ExecutionPlanRepositoryImpl (20+ —Ç–µ—Å—Ç–æ–≤):**
- ‚úÖ find_by_id: –Ω–∞–π–¥–µ–Ω
- ‚úÖ find_by_id: –Ω–µ –Ω–∞–π–¥–µ–Ω
- ‚úÖ find_by_conversation_id: –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
- ‚úÖ find_by_conversation_id: –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–ª–∞–Ω–æ–≤
- ‚úÖ save: –Ω–æ–≤—ã–π –ø–ª–∞–Ω
- ‚úÖ save: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
- ‚úÖ save: —Å subtasks
- ‚úÖ delete: —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–ª–∞–Ω
- ‚úÖ delete: –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–ª–∞–Ω
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: rollback –ø—Ä–∏ –æ—à–∏–±–∫–µ
- ‚úÖ –û—à–∏–±–∫–∏: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

**PlanMapper (5+ —Ç–µ—Å—Ç–æ–≤):**
- ‚úÖ PlanId –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è: PlanId ‚Üí str
- ‚úÖ PlanId –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è: str ‚Üí str
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ Type hints –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

**PlanRepositoryImpl (5+ —Ç–µ—Å—Ç–æ–≤):**
- ‚úÖ Snapshot: save –∏ get
- ‚úÖ Snapshot: –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
- ‚úÖ –†–∞–±–æ—Ç–∞ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º mapper

### Integration —Ç–µ—Å—Ç—ã

**Docker —Ç–µ—Å—Ç—ã:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ ExecutionPlan —á–µ—Ä–µ–∑ API
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ ExecutionPlan —á–µ—Ä–µ–∑ API
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ExecutionPlan —á–µ—Ä–µ–∑ API
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ ExecutionPlan —á–µ—Ä–µ–∑ API
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º Plan API

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –§–∞–∑—ã 10.2

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ

- ‚úÖ `ExecutionPlanMapper` —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ `ExecutionPlanRepositoryImpl` —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ `PlanMapper` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- ‚úÖ `PlanRepositoryImpl` –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ –í—Å–µ –Ω–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–∫—Ä—ã—Ç—ã —Ç–µ—Å—Ç–∞–º–∏
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ

- ‚úÖ –í—Å–µ unit —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (100%)
- ‚úÖ Docker —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ù–µ—Ç breaking changes –≤ API
- ‚úÖ –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç DDD –ø—Ä–∏–Ω—Ü–∏–ø–∞–º
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ

- ‚úÖ –§–∞–∑–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞ 7 —á–∞—Å–æ–≤ (–∏–ª–∏ –º–µ–Ω—å—à–µ)
- ‚úÖ –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –æ—Ü–µ–Ω–∫—É –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 20%

---

## üöÄ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (15 –º–∏–Ω—É—Ç)

1. –ò–∑—É—á–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ mappers –∏ repositories
2. –ò–∑—É—á–∏—Ç—å `ExecutionPlan` –∏ `Subtask` entities
3. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —à–∞–±–ª–æ–Ω—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (6.5 —á–∞—Å–æ–≤)

1. **–≠—Ç–∞–ø 1:** ExecutionPlanMapper (2—á)
2. **–≠—Ç–∞–ø 2:** ExecutionPlanRepositoryImpl (3—á)
3. **–≠—Ç–∞–ø 3:** PlanMapper update (1—á)
4. **–≠—Ç–∞–ø 4:** PlanRepositoryImpl update (1—á)

### –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è (30 –º–∏–Ω—É—Ç)

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Docker
3. –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç
4. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## üìä –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: –°–ª–æ–∂–Ω–æ—Å—Ç—å ExecutionPlan entity

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–í–ª–∏—è–Ω–∏–µ:** –í—ã—Å–æ–∫–æ–µ  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ò–∑—É—á–∏—Ç—å entity –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö mappers
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ —á–∞—Å—Ç—è–º

### –†–∏—Å–∫ 2: –ü—Ä–æ–±–ª–µ–º—ã —Å Value Objects

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–í–ª–∏—è–Ω–∏–µ:** –°—Ä–µ–¥–Ω–µ–µ  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏–∑ AgentMapper –∏ ConversationMapper
- –î–æ–±–∞–≤–∏—Ç—å helper –º–µ—Ç–æ–¥—ã –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
- –¢—â–∞—Ç–µ–ª—å–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å roundtrip –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é

### –†–∏—Å–∫ 3: –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è  
**–í–ª–∏—è–Ω–∏–µ:** –í—ã—Å–æ–∫–æ–µ  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –ù–µ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–∞ –ø—É—Ç–∏ (—Å—Ç–∞—Ä—ã–π –∏ –Ω–æ–≤—ã–π)

### –†–∏—Å–∫ 4: –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–í–ª–∏—è–Ω–∏–µ:** –°—Ä–µ–¥–Ω–µ–µ  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –°—Ç—Ä–æ–≥–æ —Å–ª–µ–¥–æ–≤–∞—Ç—å –ø–ª–∞–Ω—É
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å time-boxing
- –û—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [–ê–Ω–∞–ª–∏–∑ Infrastructure Layer](agent-runtime-phase-10-2-analysis.md)
- [–î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –§–∞–∑—ã 10.2](agent-runtime-phase-10-2-plan.md) (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω)
- [–ü—Ä–æ–≥—Ä–µ—Å—Å –§–∞–∑—ã 10](agent-runtime-phase-10-progress.md)
- [–û—Ç—á–µ—Ç –§–∞–∑—ã 10.1.4](agent-runtime-phase-10-1-4-report.md)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 6 —Ñ–µ–≤—Ä–∞–ª—è 2026, 19:21 UTC+3
