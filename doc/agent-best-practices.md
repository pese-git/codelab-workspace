# Best Practices –¥–ª—è AI Agent

## –ü—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ê–í–ò–õ–û: –û–¥–∏–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∑–∞ —Ä–∞–∑

AI –∞–≥–µ–Ω—Ç **–î–û–õ–ñ–ï–ù** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ **–û–î–ò–ù** –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∑–∞ —Ä–∞–∑ –∏ **–ñ–î–ê–¢–¨** —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º —Å–ª–µ–¥—É—é—â–µ–≥–æ.

#### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ

```
–®–∞–≥ 1: execute_command("flutter create -t app .")
  ‚Üì –ñ–î–ï–ú —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
–®–∞–≥ 2: list_files(".")
  ‚Üì –ñ–î–ï–ú —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
–®–∞–≥ 3: read_file("pubspec.yaml")
  ‚Üì –ñ–î–ï–ú —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
–®–∞–≥ 4: attempt_completion("–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω")
```

#### ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

```
–®–∞–≥ 1: execute_command("flutter create") + list_files(".") + read_file("pubspec.yaml")
  ‚Üì –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
  ‚Üì –§–∞–π–ª—ã –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω—ã
  ‚Üì –û–®–ò–ë–ö–ê: —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
```

## –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥

### –¶–∏–∫–ª —Ä–∞–±–æ—Ç—ã –∞–≥–µ–Ω—Ç–∞

```
1. –ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á–∏
   ‚Üì
2. –í—ã–±–æ—Ä –û–î–ù–û–ì–û –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
   ‚Üì
3. –í—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
   ‚Üì
4. –û–ñ–ò–î–ê–ù–ò–ï —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
   ‚Üì
5. –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
   ‚Üì
6. –ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è:
   - –ù—É–∂–µ–Ω –µ—â–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç? ‚Üí –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —à–∞–≥—É 2
   - –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞? ‚Üí attempt_completion
   - –ù—É–∂–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è? ‚Üí ask_followup_question
```

## –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

```python
# –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ
execute_command("flutter create -t app my_project")
# –ñ–î–ï–ú: –ö–æ–º–∞–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã

# –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
list_files("my_project")
# –ñ–î–ï–ú: –ü–æ–ª—É—á–µ–Ω —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤

# –®–∞–≥ 3: –ß—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
read_file("my_project/pubspec.yaml")
# –ñ–î–ï–ú: –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

# –®–∞–≥ 4: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
attempt_completion("–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ")
```

### –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ–∞–π–ª–∞

```python
# –®–∞–≥ 1: –ß—Ç–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
read_file("lib/main.dart")
# –ñ–î–ï–ú: –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

# –®–∞–≥ 2: –ê–Ω–∞–ª–∏–∑ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
# (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∞–Ω–∞–ª–∏–∑, –±–µ–∑ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤)

# –®–∞–≥ 3: –ó–∞–ø–∏—Å—å –∏–∑–º–µ–Ω–µ–Ω–∏–π
write_file("lib/main.dart", new_content)
# –ñ–î–ï–ú: –§–∞–π–ª –∑–∞–ø–∏—Å–∞–Ω, –ø–æ–ª—É—á–µ–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

# –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
read_file("lib/main.dart", start_line=10, end_line=20)
# –ñ–î–ï–ú: –ü–æ–ª—É—á–µ–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

# –®–∞–≥ 5: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
attempt_completion("–§–∞–π–ª –æ–±–Ω–æ–≤–ª–µ–Ω")
```

### –ü–æ–∏—Å–∫ –∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥

```python
# –®–∞–≥ 1: –ü–æ–∏—Å–∫ –ø–∞—Ç—Ç–µ—Ä–Ω–∞
search_in_code("class.*Widget", file_pattern="*.dart")
# –ñ–î–ï–ú: –ü–æ–ª—É—á–µ–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞

# –®–∞–≥ 2: –ß—Ç–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
read_file("lib/widgets/my_widget.dart")
# –ñ–î–ï–ú: –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

# –®–∞–≥ 3: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è
write_file("lib/widgets/my_widget.dart", refactored_content)
# –ñ–î–ï–ú: –§–∞–π–ª –∑–∞–ø–∏—Å–∞–Ω

# –®–∞–≥ 4: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
attempt_completion("–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω")
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å

```python
# –®–∞–≥ 1: –ü–æ–ø—ã—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
execute_command("flutter pub get")
# –ñ–î–ï–ú: –ü–æ–ª—É—á–µ–Ω–∞ –æ—à–∏–±–∫–∞

# –®–∞–≥ 2: –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–∫–∏
# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø–æ–Ω—è—Ç–Ω–∞ ‚Üí –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ
# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –Ω–µ–ø–æ–Ω—è—Ç–Ω–∞ ‚Üí ask_followup_question

# –®–∞–≥ 3: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∏–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
execute_command("flutter pub get --verbose")
# –ñ–î–ï–ú: –†–µ–∑—É–ª—å—Ç–∞—Ç

# –®–∞–≥ 4: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–ª–∏ —ç—Å–∫–∞–ª–∞—Ü–∏—è
attempt_completion("–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã") 
# –∏–ª–∏
ask_followup_question("–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É?")
```

## –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã

### ‚ùå –ü—Ä–µ–¥—É–≥–∞–¥—ã–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```python
# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
execute_command("flutter create my_app")
# –°—Ä–∞–∑—É –ø—ã—Ç–∞–µ–º—Å—è —á–∏—Ç–∞—Ç—å, –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
read_file("my_app/pubspec.yaml")  # ‚ùå –§–∞–π–ª –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω!
```

### ‚ùå –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã

```python
# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
# –ü–æ–ø—ã—Ç–∫–∞ –≤—ã–∑–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
[
  execute_command("flutter create"),
  list_files("."),
  read_file("pubspec.yaml")
]  # ‚ùå –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ "–æ–¥–∏–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∑–∞ —Ä–∞–∑"
```

### ‚ùå –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```python
# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
execute_command("flutter build apk")
# –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —Å—Ä–∞–∑—É –≥–æ–≤–æ—Ä–∏–º "–≥–æ—Ç–æ–≤–æ"
attempt_completion("APK —Å–æ–±—Ä–∞–Ω")  # ‚ùå –ê –≤–¥—Ä—É–≥ –±—ã–ª–∞ –æ—à–∏–±–∫–∞?
```

## –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ –∫–æ–¥–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª:

```python
# –í llm_stream_service.py
if len(tool_calls) > 1:
    logger.warning(
        f"[Agent][VALIDATION] LLM attempted to call {len(tool_calls)} tools simultaneously!"
    )
    # –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
```

–ü—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –ø—Ä–∞–≤–∏–ª –≤ –ª–æ–≥–∞—Ö –ø–æ—è–≤–∏—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:
```
[Agent][VALIDATION] LLM attempted to call 3 tools simultaneously! 
This violates the one-tool-at-a-time rule. 
Tools: ['execute_command', 'list_files', 'read_file']
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

–ò—â–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö:
- `[Agent][VALIDATION]` - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö
- `[Agent] Tool call detected` - –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- `[Agent] Tool '...' result` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

–•–æ—Ä–æ—à–∏–π –∞–≥–µ–Ω—Ç:
- ‚úÖ 0 –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö tool calls
- ‚úÖ –ß–µ—Ç–∫–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: tool ‚Üí result ‚Üí tool ‚Üí result
- ‚úÖ –ù–µ—Ç –ø–æ–ø—ã—Ç–æ–∫ —á—Ç–µ–Ω–∏—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤](./agent-tool-usage-fix.md)
- [–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç](../codelab-ai-service/agent-runtime/app/core/agent/prompts.py)
- [–í–∞–ª–∏–¥–∞—Ü–∏—è tool calls](../codelab-ai-service/agent-runtime/app/services/llm_stream_service.py)

---

**–ü–æ–º–Ω–∏—Ç–µ:** –¢–µ—Ä–ø–µ–Ω–∏–µ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å - –∫–ª—é—á –∫ –Ω–∞–¥–µ–∂–Ω–æ–π —Ä–∞–±–æ—Ç–µ AI –∞–≥–µ–Ω—Ç–∞!
