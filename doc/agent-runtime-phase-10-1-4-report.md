# üìä –û—Ç—á–µ—Ç –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –§–∞–∑—ã 10.1.4

**–î–∞—Ç–∞:** 6 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 2 —á–∞—Å–∞ 30 –º–∏–Ω—É—Ç  

---

## üéØ –¶–µ–ª—å —Ñ–∞–∑—ã

–û–±–Ω–æ–≤–∏—Ç—å Dependency Injection container –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö legacy —Å–µ—Ä–≤–∏—Å–æ–≤, –æ–±–µ—Å–ø–µ—á–∏–≤ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ DI Container

**–§–∞–π–ª:** [`app/core/dependencies.py`](../codelab-ai-service/agent-runtime/app/core/dependencies.py)

- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ legacy —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∞–¥–∞–ø—Ç–µ—Ä–æ–≤
- –í—Å–µ 7 domain services —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä—ã

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (7 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º)

1. ‚úÖ **DomainEvent** - –¥–æ–±–∞–≤–ª–µ–Ω—ã `get_event_name()` –∏ `aggregate_id`
2. ‚úÖ **MessageCollection** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –¥–æ—Å—Ç—É–ø –∫ —Å–ø–∏—Å–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π
3. ‚úÖ **AgentId** - –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ Pydantic, —É–±—Ä–∞–Ω—ã –ø—Ä–µ—Ñ–∏–∫—Å—ã
4. ‚úÖ **Agent Events** - –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ Pydantic –ø–æ–ª—è
5. ‚úÖ **AgentCoordinationService** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ —Å–æ–±—ã—Ç–∏–π
6. ‚úÖ **AgentOrchestrationAdapter** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è switch_history
7. ‚úÖ **ConversationRepository** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `save_snapshot()` –∏ `get_snapshot()`

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### Unit —Ç–µ—Å—Ç—ã
```bash
uv run pytest tests/unit/domain/adapters/ tests/unit/domain/session_context/services/ tests/unit/domain/agent_context/services/ -v
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ **77/77 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏** (100%)
- ‚úÖ –í—Å–µ –∞–¥–∞–ø—Ç–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ù–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### Integration —Ç–µ—Å—Ç—ã (Docker)
```bash
curl -X POST http://localhost:8001/sessions
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ –°–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –°–µ—Å—Å–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- ‚úÖ –°–æ–±—ã—Ç–∏—è –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **–ù–µ—Ç –æ—à–∏–±–æ–∫ ERROR** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ | 9 |
| –°—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ | ~250 |
| –°—Ç—Ä–æ–∫ —É–¥–∞–ª–µ–Ω–æ | ~250 |
| –ù–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π DI | 2 |
| –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π DI | 2 |
| –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Value Objects | 1 (AgentId) |
| –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Events | 5 —Å–æ–±—ã—Ç–∏–π |
| –ù–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –≤ Repository | 2 (save_snapshot, get_snapshot) |

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|-----------|-----------|
| –¢–µ—Å—Ç—ã | 77/77 (100%) ‚úÖ |
| Docker | –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ ‚úÖ |
| API | –†–∞–±–æ—Ç–∞–µ—Ç ‚úÖ |
| –†–µ–≥—Ä–µ—Å—Å–∏–∏ | 0 ‚úÖ |

### –í—Ä–µ–º—è
| –≠—Ç–∞–ø | –§–∞–∫—Ç |
|------|------|
| –ê–Ω–∞–ª–∏–∑ | 30–º |
| –†–µ–∞–ª–∏–∑–∞—Ü–∏—è DI | 30–º |
| –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º | 1—á 30–º |
| **–ò—Ç–æ–≥–æ** | **2—á 30–º** |

**–≠–∫–æ–Ω–æ–º–∏—è:** 2 —á–∞—Å–∞ 30 –º–∏–Ω—É—Ç –æ—Ç –æ—Ü–µ–Ω–∫–∏ (5 —á–∞—Å–æ–≤)

---

## üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –§–∞–∑—ã 10

```
–§–∞–∑–∞ 10: –ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (21 —á–∞—Å)
‚îú‚îÄ‚îÄ ‚úÖ 10.1.1: SessionManagementService (1.5—á / 2—á)
‚îú‚îÄ‚îÄ ‚úÖ 10.1.2: AgentOrchestrationService (1.5—á / 2—á)
‚îú‚îÄ‚îÄ ‚úÖ 10.1.3: ExecutionEngine (1.5—á / 3—á)
‚îú‚îÄ‚îÄ ‚úÖ 10.1.4: DI Container + Fixes (2.5—á / 5—á)
‚îú‚îÄ‚îÄ ‚è≥ 10.2: Infrastructure Layer (0—á / 5—á)
‚îú‚îÄ‚îÄ ‚è≥ 10.3: Application Layer (0—á / 3.5—á)
‚îî‚îÄ‚îÄ ‚è≥ 10.4: Legacy Code Removal (0—á / 2.5—á)

–ü—Ä–æ–≥—Ä–µ—Å—Å: 35% (7/21 —á–∞—Å–æ–≤)
–≠–∫–æ–Ω–æ–º–∏—è: 5 —á–∞—Å–æ–≤ (–ø–ª–∞–Ω: 12—á, —Ñ–∞–∫—Ç: 7—á)
–¢–µ—Å—Ç—ã: 77/77 –ø—Ä–æ—Ö–æ–¥—è—Ç (100%)
```

---

## üéâ –í—ã–≤–æ–¥—ã

### –ß—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–ª–æ –æ—Ç–ª–∏—á–Ω–æ
1. ‚úÖ **–°—Ç—Ä–∞—Ç–µ–≥–∏—è –í–∞—Ä–∏–∞–Ω—Ç –ê** - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ
2. ‚úÖ **–ê–¥–∞–ø—Ç–µ—Ä—ã** - –æ–±–µ—Å–ø–µ—á–∏–ª–∏ –ø–ª–∞–≤–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
3. ‚úÖ **Pydantic –º–∏–≥—Ä–∞—Ü–∏—è** - —É–ª—É—á—à–∏–ª–∞ —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
4. ‚úÖ **–ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–∑–≤–æ–ª–∏–ª–æ –Ω–∞–π—Ç–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã

### –£—Ä–æ–∫–∏
1. üí° –ò–∑–º–µ–Ω–µ–Ω–∏–µ DI container —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
2. üí° Pydantic Value Objects –ª—É—á—à–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤
3. üí° –£–±—Ä–∞—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å—ã –∏–∑ ID –ø—Ä–æ—â–µ, —á–µ–º –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ë–î
4. üí° Frozen –º–æ–¥–µ–ª–∏ —Ç—Ä–µ–±—É—é—Ç Pydantic –ø–æ–ª–µ–π –≤–º–µ—Å—Ç–æ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ `__init__`
5. üí° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Docker –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è runtime –ø—Ä–æ–±–ª–µ–º

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –§–∞–∑–∞ 10.2: Infrastructure Layer (4-6 —á–∞—Å–æ–≤)
- –û–±–Ω–æ–≤–∏—Ç—å Mappers
- –û–±–Ω–æ–≤–∏—Ç—å Repository Implementations
- –û–±–Ω–æ–≤–∏—Ç—å Database Models

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 6 —Ñ–µ–≤—Ä–∞–ª—è 2026, 17:43 UTC+3
