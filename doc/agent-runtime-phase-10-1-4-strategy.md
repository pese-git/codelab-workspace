# üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –§–∞–∑—ã 10.1.4: –ú–∏–≥—Ä–∞—Ü–∏—è Domain Services

**–î–∞—Ç–∞:** 6 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–°—Ç–∞—Ç—É—Å:** üìã –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞  

---

## üîç –ü—Ä–æ–±–ª–µ–º–∞

7 domain services –∏—Å–ø–æ–ª—å–∑—É—é—Ç legacy `SessionManagementService` –∏ `AgentOrchestrationService`:
- message_processor.py
- agent_switcher.py
- tool_result_handler.py
- hitl_decision_handler.py
- plan_approval_handler.py
- subtask_executor.py
- dependency_resolver.py

---

## ‚úÖ –ß—Ç–æ —É–∂–µ –µ—Å—Ç—å

–ê–¥–∞–ø—Ç–µ—Ä—ã —Å–æ–∑–¥–∞–Ω—ã –≤ –§–∞–∑–∞—Ö 10.1.1-10.1.3:
- ‚úÖ `ConversationServiceAdapter` - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API `SessionManagementService`
- ‚úÖ `AgentOrchestrationAdapter` - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API `AgentOrchestrationService`
- ‚úÖ `ExecutionEngineAdapter` - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API `ExecutionEngine`

---

## üéØ –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç –ê: –û–±–Ω–æ–≤–∏—Ç—å DI Container (–í–´–ë–†–ê–ù)

**–ò–¥–µ—è:** –ù–µ –º–µ–Ω—è—Ç—å —Å–∞–º–∏ —Å–µ—Ä–≤–∏—Å—ã, –∞ –æ–±–Ω–æ–≤–∏—Ç—å Dependency Injection, —á—Ç–æ–±—ã –≤–º–µ—Å—Ç–æ legacy —Å–µ—Ä–≤–∏—Å–æ–≤ –∏–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å –∞–¥–∞–ø—Ç–µ—Ä—ã.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ
- ‚úÖ –°–µ—Ä–≤–∏—Å—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- ‚úÖ –õ–µ–≥–∫–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–µ—Å—Ç—ã

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –°–µ—Ä–≤–∏—Å—ã –≤—Å–µ –µ—â–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç legacy API

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –í DI container (app/dependencies.py –∏–ª–∏ main.py)

# –ë—ã–ª–æ:
session_service = SessionManagementService(session_repo)
agent_service = AgentOrchestrationService(agent_repo)

# –°—Ç–∞–Ω–µ—Ç:
conversation_service = ConversationManagementService(conversation_repo)
session_service = ConversationServiceAdapter(conversation_service)

coordination_service = AgentCoordinationService(agent_repo)
agent_service = AgentOrchestrationAdapter(coordination_service)
```

---

### –í–∞—Ä–∏–∞–Ω—Ç –ë: –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö

**–ò–¥–µ—è:** –ò–∑–º–µ–Ω–∏—Ç—å TYPE_CHECKING –∏–º–ø–æ—Ä—Ç—ã –≤ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –Ø–≤–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∞–¥–∞–ø—Ç–µ—Ä–æ–≤
- ‚úÖ –ë–æ–ª–µ–µ —á–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –ù—É–∂–Ω–æ –º–µ–Ω—è—Ç—å 7 —Ñ–∞–π–ª–æ–≤
- ‚ùå –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–µ—Å—Ç—ã
- ‚ùå –ë–æ–ª—å—à–µ —Ä–∏—Å–∫–∞ –æ—à–∏–±–æ–∫

---

## üìã –í—ã–±—Ä–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è: –í–∞—Ä–∏–∞–Ω—Ç –ê

### –ü–æ—á–µ–º—É –í–∞—Ä–∏–∞–Ω—Ç –ê?

1. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫** - –Ω–µ –º–µ–Ω—è–µ–º —Ä–∞–±–æ—á–∏–π –∫–æ–¥
2. **–ë—ã—Å—Ç—Ä–æ—Ç–∞** - –æ–¥–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ DI container
3. **–û–±—Ä–∞—Ç–∏–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –æ—Ç–∫–∞—Ç–∏—Ç—å
4. **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—É** - –∞–¥–∞–ø—Ç–µ—Ä—ã —Å–æ–∑–¥–∞–Ω—ã –∏–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ

### –ß—Ç–æ –ù–ï –¥–µ–ª–∞–µ–º –≤ –§–∞–∑–µ 10.1.4

‚ùå –ù–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ–º —Å–µ—Ä–≤–∏—Å—ã  
‚ùå –ù–µ –º–µ–Ω—è–µ–º –∏–º–ø–æ—Ä—Ç—ã –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö  
‚ùå –ù–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤  
‚ùå –ù–µ —Ç—Ä–æ–≥–∞–µ–º legacy entities  

### –ß—Ç–æ –¥–µ–ª–∞–µ–º –≤ –§–∞–∑–µ 10.1.4

‚úÖ –û–±–Ω–æ–≤–ª—è–µ–º DI container –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–¥–∞–ø—Ç–µ—Ä–æ–≤  
‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é  

---

## üöÄ –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –®–∞–≥ 1: –ù–∞–π—Ç–∏ DI Container
–ù–∞–π—Ç–∏ –≥–¥–µ —Å–æ–∑–¥–∞—é—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä—ã —Å–µ—Ä–≤–∏—Å–æ–≤:
- `app/dependencies.py`
- `app/main.py`
- `app/api/dependencies.py`

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
–ó–∞–º–µ–Ω–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ legacy —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ –∞–¥–∞–ø—Ç–µ—Ä—ã:
```python
# SessionManagementService ‚Üí ConversationServiceAdapter
# AgentOrchestrationService ‚Üí AgentOrchestrationAdapter
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã
–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç.

### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ—Ç—á–µ—Ç–µ.

---

## ‚è±Ô∏è –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

| –ó–∞–¥–∞—á–∞ | –í—Ä–µ–º—è |
|--------|-------|
| –ù–∞–π—Ç–∏ DI container | 10 –º–∏–Ω |
| –û–±–Ω–æ–≤–∏—Ç—å DI | 20 –º–∏–Ω |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 30 –º–∏–Ω |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | 20 –º–∏–Ω |
| **–ò—Ç–æ–≥–æ** | **1 —á–∞—Å 20 –º–∏–Ω—É—Ç** |

**–≠–∫–æ–Ω–æ–º–∏—è:** 3 —á–∞—Å–∞ 40 –º–∏–Ω—É—Ç –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ (5 —á–∞—Å–æ–≤)

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

‚úÖ DI container –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–¥–∞–ø—Ç–µ—Ä—ã –≤–º–µ—Å—Ç–æ legacy —Å–µ—Ä–≤–∏—Å–æ–≤  
‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç  
‚úÖ API endpoints –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å  
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞  

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ 10.1.4

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –§–∞–∑—ã 10.1.4:
- **–§–∞–∑–∞ 10.2:** –ú–∏–≥—Ä–∞—Ü–∏—è Infrastructure Layer (repositories, mappers)
- **–§–∞–∑–∞ 10.3:** –ú–∏–≥—Ä–∞—Ü–∏—è Application Layer (use cases, coordinators)
- **–§–∞–∑–∞ 10.4:** –£–¥–∞–ª–µ–Ω–∏–µ legacy –∫–æ–¥–∞

---

## üö® –í–∞–∂–Ω–æ

**Legacy —Å–µ—Ä–≤–∏—Å—ã –æ—Å—Ç–∞–Ω—É—Ç—Å—è –¥–æ –§–∞–∑—ã 10.4!**

–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –∏ –æ–∂–∏–¥–∞–µ–º–æ. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Strangler Fig Pattern:
1. –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É ‚úÖ (–§–∞–∑—ã 1-9)
2. –°–æ–∑–¥–∞–µ–º –∞–¥–∞–ø—Ç–µ—Ä—ã ‚úÖ (–§–∞–∑—ã 10.1.1-10.1.3)
3. –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º DI –Ω–∞ –∞–¥–∞–ø—Ç–µ—Ä—ã ‚è≥ (–§–∞–∑–∞ 10.1.4)
4. –ú–∏–≥—Ä–∏—Ä—É–µ–º Infrastructure ‚è≥ (–§–∞–∑–∞ 10.2)
5. –ú–∏–≥—Ä–∏—Ä—É–µ–º Application ‚è≥ (–§–∞–∑–∞ 10.3)
6. –£–¥–∞–ª—è–µ–º legacy –∫–æ–¥ ‚è≥ (–§–∞–∑–∞ 10.4)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 6 —Ñ–µ–≤—Ä–∞–ª—è 2026, 15:04 UTC+3
