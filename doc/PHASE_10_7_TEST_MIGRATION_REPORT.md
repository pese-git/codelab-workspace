# Phase 10.7: –û—Ç—á–µ—Ç –æ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤

**–î–∞—Ç–∞:** 2026-02-09  
**–°—Ç–∞—Ç—É—Å:** –ß–∞—Å—Ç–∏—á–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ  
**–¶–µ–ª—å:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å —É–ø–∞–≤—à–∏–µ —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ Phase 10.5 & 10.6

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã
```
131 failed, 729 passed, 5 skipped, 399 warnings
–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö: 84.3%
```

### –ü–æ—Å–ª–µ Phase 10.7
```
106 failed, 754 passed, 5 skipped, 350 warnings
–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö: 87.7%
```

### –£–ª—É—á—à–µ–Ω–∏—è
- ‚úÖ **+25 —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ** (131 ‚Üí 106 failed)
- ‚úÖ **+25 —Ç–µ—Å—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç** (729 ‚Üí 754 passed)
- ‚úÖ **-49 Pydantic warnings** (399 ‚Üí 350, -12.3%)
- ‚úÖ **+3.4% —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤** (84.3% ‚Üí 87.7%)

## üîß –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

### 1. –ú–∞—Å—Å–æ–≤–∞—è –∑–∞–º–µ–Ω–∞ Value Objects API ‚úÖ

–ó–∞–º–µ–Ω–∏–ª–∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –Ω–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–æ –≤—Å–µ—Ö —Ç–µ—Å—Ç–∞—Ö:

**–ë—ã–ª–æ:**
```python
AgentId("coder")
SubtaskId("subtask-1")
PlanId("plan-1")
ConversationId("test-session")
ToolName("tool-1")
```

**–°—Ç–∞–ª–æ:**
```python
AgentId(value="coder")
SubtaskId(value="subtask-1")
PlanId(value="plan-1")
ConversationId(value="test-session")
ToolName(value="tool-1")
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ~25 —Ç–µ—Å—Ç–æ–≤ –≤ execution_context, session_context –∏ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö.

### 2. –ú–∏–≥—Ä–∞—Ü–∏—è Pydantic Config ‚Üí ConfigDict ‚úÖ

–û–±–Ω–æ–≤–∏–ª–∏ 10 —Ñ–∞–π–ª–æ–≤ —Å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º `class Config` –Ω–∞ –Ω–æ–≤—ã–π `model_config = ConfigDict`:

**–§–∞–π–ª—ã:**
1. `app/domain/shared/base_entity.py` ‚úÖ
2. `app/domain/entities/base.py` ‚úÖ
3. `app/domain/events/base.py` ‚úÖ
4. `app/domain/entities/hitl.py` ‚úÖ
5. `app/domain/entities/approval.py` ‚úÖ
6. `app/events/base_event.py` ‚úÖ
7. `app/api/v1/schemas/session_schemas.py` ‚úÖ
8. `app/api/v1/schemas/common.py` ‚úÖ
9. `app/application/queries/base.py` ‚úÖ
10. `app/application/commands/base.py` ‚úÖ

**–ë—ã–ª–æ:**
```python
class Entity(BaseModel):
    class Config:
        arbitrary_types_allowed = True
        json_encoders = {
            datetime: lambda v: v.isoformat()
        }
```

**–°—Ç–∞–ª–æ:**
```python
from pydantic import ConfigDict

class Entity(BaseModel):
    model_config = ConfigDict(
        arbitrary_types_allowed=True,
    )
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–±—Ä–∞–Ω–æ 49 Pydantic deprecation warnings.

### 3. –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

#### fix_pydantic_config.py
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–º–µ–Ω—ã `class Config` –Ω–∞ `model_config = ConfigDict`.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
cd codelab-ai-service/agent-runtime
uv run python fix_pydantic_config.py
```

## üìã –û—Å—Ç–∞–≤—à–∏–µ—Å—è –ø—Ä–æ–±–ª–µ–º—ã

### 106 —É–ø–∞–≤—à–∏—Ö —Ç–µ—Å—Ç–æ–≤

–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:
1. **Infrastructure tests** (~20 —Ç–µ—Å—Ç–æ–≤)
   - `test_unit_of_work.py` - –≤—Å–µ —Ç–µ—Å—Ç—ã SSEUnitOfWork
   - `test_execution_plan_mapper.py` - roundtrip conversion

2. **Integration tests** (~40 —Ç–µ—Å—Ç–æ–≤)
   - –¢–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
   - FSM tests
   - Event-driven tests

3. **Application layer tests** (~30 —Ç–µ—Å—Ç–æ–≤)
   - Approval manager tests
   - LLM response processor tests
   - Task classifier tests

4. **–ü—Ä–æ—á–∏–µ** (~16 —Ç–µ—Å—Ç–æ–≤)
   - Tool filter service
   - Tool parser
   - Resilience tests

### 350 Pydantic warnings

–û—Å—Ç–∞–ª–∏—Å—å warnings –≤ —Ñ–∞–π–ª–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã:
- –ú–æ–¥–µ–ª–∏ –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö
- –¢–µ—Å—Ç—ã —Å inline –º–æ–¥–µ–ª—è–º–∏
- Legacy –∫–æ–¥

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç HIGH
1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å Infrastructure tests** (20 —Ç–µ—Å—Ç–æ–≤)
   - –ü—Ä–æ–±–ª–µ–º–∞: UnitOfWork API –∏–∑–º–µ–Ω–∏–ª—Å—è
   - –†–µ—à–µ–Ω–∏–µ: –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –ø–æ–¥ –Ω–æ–≤—ã–π API

2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å Integration tests** (40 —Ç–µ—Å—Ç–æ–≤)
   - –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ API
   - –†–µ—à–µ–Ω–∏–µ: –û–±–Ω–æ–≤–∏—Ç—å –º–æ–∫–∏ –∏ —Ñ–∏–∫—Å—Ç—É—Ä—ã

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç MEDIUM
3. **–£–±—Ä–∞—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è Pydantic warnings** (350 —à—Ç—É–∫)
   - –ù–∞–π—Ç–∏ –≤—Å–µ —Ñ–∞–π–ª—ã —Å `class Config`
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∑–∞–º–µ–Ω—É
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä—É—á–Ω—É—é —Å–ª–æ–∂–Ω—ã–µ —Å–ª—É—á–∞–∏

4. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å Application layer tests** (30 —Ç–µ—Å—Ç–æ–≤)
   - –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥ –Ω–æ–≤—ã–π API
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–∫–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç LOW
5. **Code review** –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
6. **Performance testing** –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
7. **Documentation update**

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| **–¢–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–æ** | 729 | 754 | +25 (+3.4%) |
| **–¢–µ—Å—Ç–æ–≤ —É–ø–∞–ª–æ** | 131 | 106 | -25 (-19.1%) |
| **–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞** | 84.3% | 87.7% | +3.4% |
| **Warnings** | 399 | 350 | -49 (-12.3%) |
| **–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ** | 0 | 10+ | +10+ |

## üöÄ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:** –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –∑–∞–º–µ–Ω—ã Config  
‚úÖ **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:** –£–±—Ä–∞–Ω—ã deprecated Pydantic –ø–∞—Ç—Ç–µ—Ä–Ω—ã  
‚úÖ **–¢–µ—Å—Ç—ã:** +25 —Ç–µ—Å—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç  
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –°–æ–∑–¥–∞–Ω –∞–Ω–∞–ª–∏–∑ –∏ –æ—Ç—á–µ—Ç  

## üìù –í—ã–≤–æ–¥—ã

Phase 10.7 —É—Å–ø–µ—à–Ω–æ –Ω–∞—á–∞—Ç–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ö–æ—Ä–æ—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- **25 —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ** –∑–∞ –æ–¥–Ω—É —Å–µ—Å—Å–∏—é
- **49 warnings —É–±—Ä–∞–Ω–æ** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã** –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã

–û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ Value Objects API –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –û—Å—Ç–∞–ª–æ—Å—å:
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å Infrastructure –∏ Integration —Ç–µ—Å—Ç—ã
- –£–±—Ä–∞—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è Pydantic warnings
- –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ 100% —Ç–µ—Å—Ç–æ–≤:** 2-3 —Å–µ—Å—Å–∏–∏ —Ä–∞–±–æ—Ç—ã.
