
# üü• **POC: AI Agent Service (Microservice Architecture)**

## –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–±–æ—á–∏–π –≤–∞—Ä–∏–∞–Ω—Ç AI Agent Service, –∫–æ—Ç–æ—Ä—ã–π:

* —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Codelab IDE —á–µ—Ä–µ–∑ Gateway (WS)
* –≤—ã–ø–æ–ª–Ω—è–µ—Ç reasoning —á–µ—Ä–µ–∑ LLM
* –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ tool-calls
* –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ IDE
* –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–π streaming
* –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

POC –¥–æ–ª–∂–µ–Ω –¥–æ–∫–∞–∑–∞—Ç—å:

* –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
* —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å latency
* –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —ç–Ω–¥-—Ç—É-—ç–Ω–¥ pipeline (User ‚Üí IDE ‚Üí Gateway ‚Üí Agent ‚Üí LLM ‚Üí Tools ‚Üí IDE)
* –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ tool-calls —á–µ—Ä–µ–∑ –∞–≥–µ–Ω—Ç–∞
* —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –æ—à–∏–±–∫–∞–º

---

# üü¶ **1. –ö–∞–∫–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –Ω—É–∂–Ω—ã –≤ POC (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ):**

–î–ª—è POC –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ **3 —Å–µ—Ä–≤–∏—Å–æ–≤**:

---

## üü© 1) **Gateway Service (WebSocket)** ‚Äî MVP-–≤–∞—Ä–∏–∞–Ω—Ç

**–ó–∞–¥–∞—á–∏:**

* –ø—Ä–∏–Ω–∏–º–∞—Ç—å WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –æ—Ç IDE
* –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è IDE ‚Üî Agent
* –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—ã–π streaming —Ç–æ–∫–µ–Ω–æ–≤
* –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ —Ç–æ–∫–µ–Ω—É (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è)

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:**

* **Python (FastAPI + WebSocket)**

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞:**
–ï–¥–∏–Ω—ã–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ –Ω–∞ Python FastAPI –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã
- –ü—Ä–æ—Å—Ç–æ—Ç—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ —Ä–∞–∑–≤–∏—Ç–∏—è
- –û–±—â–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã
- –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π CI/CD pipeline

---

## üü¶ 2) **Agent Runtime Service (Core AI Logic)** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å POC

**–ó–∞–¥–∞—á–∏:**

* –ø—Ä–∏–Ω–∏–º–∞—Ç—å `user_message`
* –∑–∞–ø—É—Å–∫–∞—Ç—å LLM –∑–∞–ø—Ä–æ—Å
* —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å tool-calls (OpenAI spec)
* –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å tool-calls –≤ Gateway
* –ø–æ–ª—É—á–∞—Ç—å tool-results
* –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å reasoning
* –æ—Ç–¥–∞–≤–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ features:**

* LLM Tool Calling
* Streaming
* Multi-turn reasoning
* Error handling (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π)
* –û—Å–Ω–æ–≤–Ω—ã–µ tools:

  * read_file
  * write_file
  * git.diff
  * apply_patch

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:**

* **Python + FastAPI + Asyncio**

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞:**

* –ï–¥–∏–Ω—ã–π —Å—Ç–µ–∫ —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
* –û—Ç–ª–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ async/await –¥–ª—è streaming
* –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM API
* –ë–æ–≥–∞—Ç–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ Python –±–∏–±–ª–∏–æ—Ç–µ–∫ –¥–ª—è AI

---

## üüß 3) **LLM Proxy Service** ‚Äî POC-–≤–∞—Ä–∏–∞–Ω—Ç

**–ó–∞–¥–∞—á–∏:**

* –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –æ—Ç Agent Runtime
* –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –≤ LLM (OpenAI)
* –≤—ã–ø–ª—ë–≤—ã–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã stream –æ–±—Ä–∞—Ç–Ω–æ –∞–≥–µ–Ω—Ç—É

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:**

* **Python FastAPI**

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞:**

* –ï–¥–∏–Ω—ã–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
* –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏
* –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ streaming —á–µ—Ä–µ–∑ SSE/WebSocket
* –û–±—â–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

**–ù—É–∂–Ω—ã –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

* streaming (SSE –∏–ª–∏ chunked response)
* –ø–æ–¥–¥–µ—Ä–∂–∫–∞ OpenAI function calling

---

# üü´ **2. –ö–∞–∫–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –ù–ï –Ω—É–∂–Ω—ã –≤ POC (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ—Ç–æ–º)**

–ù–µ –Ω—É–∂–Ω—ã –Ω–∞ –ø–µ—Ä–≤–æ–π –≤–µ—Ä—Å–∏–∏:

* Patch Review Service
* Approval Service
* Telemetry Service
* Session Store (–º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø–∞–º—è—Ç–∏)
* Rate Limits
* Billing
* Multi-tenant_id

---

# üü• **3. –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ POC**

```mermaid
flowchart LR

IDE[Codelab IDE\n(Local Tools)] 
  -->|WebSocket| GW[Gateway Service]

GW -->|user_message| AGENT[Agent Runtime]
AGENT -->|LLM Request| LLM[LLM Proxy]
LLM -->|Streaming Tokens| AGENT

AGENT -->|tool_call| GW
GW -->|tool_call| IDE
IDE -->|tool_result| GW
GW --> AGENT

AGENT -->|final message| GW
GW --> IDE
```

---

# üü© **4. –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª POC**

POC –¥–æ–ª–∂–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª:

---

## üî∑ 1) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí IDE ‚Üí Gateway ‚Üí Agent

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∑–∞–ø—Ä–æ—Å:

> "–î–æ–±–∞–≤—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª auth.js"

IDE –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:

```json
{
  "type": "user_message",
  "content": "Add logging to auth.js"
}
```

---

## üî∑ 2) Agent ‚Üí LLM (Tool Calling)

–ê–≥–µ–Ω—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç –∑–∞–ø—Ä–æ—Å:

```json
{
  "model": "gpt-4o",
  "messages": [...],
  "tools": [...]
}
```

---

## üî∑ 3) LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç tool-call

–ù–∞–ø—Ä–∏–º–µ—Ä:

```json
{
  "tool": "read_file",
  "arguments": { "path": "src/auth.js" }
}
```

---

## üî∑ 4) Agent ‚Üí Gateway ‚Üí IDE (–≤—ã–ø–æ–ª–Ω–∏—Ç—å tool)

IDE –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞.

---

## üî∑ 5) Agent ‚Üí LLM (reasoning continues)

LLM –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ñ–∞–π–ª–∞ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç:

* –ø–∞—Ç—á
  –∏–ª–∏
* –Ω–æ–≤—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
  –∏–ª–∏
* —Å–ª–µ–¥—É—é—â–∏–π tool call

---

## üî∑ 6) Apply Patch

Agent –≤—ã–∑—ã–≤–∞–µ—Ç tool:

```json
{
  "tool": "apply_patch",
  "args": { "diff": "diff --git..." }
}
```

IDE –ø—Ä–∏–º–µ–Ω—è–µ—Ç –ø–∞—Ç—á.

---

## üî∑ 7) Agent –∑–∞–≤–µ—Ä—à–∞–µ—Ç –æ—Ç–≤–µ—Ç ‚Üí Gateway ‚Üí IDE

Streaming + —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç.

---

# üü¶ **5. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä Tools –¥–ª—è POC**

–ü–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ: **[tools-specification.md](./tools-specification.md)**

### MVP Tools (6 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤):

1) `read_file` - —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
2) `write_file` - –∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤
3) `git.diff` - –ø–æ–ª—É—á–µ–Ω–∏–µ diff
4) `apply_patch` - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ç—á–µ–π
5) `apply_patch_review` - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π
6) `prompt_user` - –∑–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–°–º. –¥–µ—Ç–∞–ª—å–Ω—É—é —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é –∫–∞–∂–¥–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –≤ [tools-specification.md](./tools-specification.md#3-–¥–µ—Ç–∞–ª—å–Ω–∞—è-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è-mvp-tools)

---

# üü• **6. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ POC**

### üîπ Streaming —Ç–æ–∫–µ–Ω–æ–≤

LLM Proxy ‚Üí Agent ‚Üí Gateway ‚Üí IDE

### üîπ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ tool-calling

–ù–∞ —É—Ä–æ–≤–Ω–µ OpenAI JSON —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π.

### üîπ Errors –ª–æ–≥–∏–∫–∞

–í–∏–¥–∏—Ç –æ—à–∏–±–∫—É IDE –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

### üîπ Single-session

–ù–µ –Ω—É–∂–µ–Ω multi-tenancy.

### üîπ Stateless —Å–µ—Ä–≤–µ—Ä–∞

–ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∏—Ö –ª–æ–∫–∞–ª—å–Ω–æ.

---

# üü© **7. –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π**

### –ï–¥–∏–Ω—ã–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

–í—Å–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç **Python FastAPI** –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è:
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã
- –ü—Ä–æ—Å—Ç–æ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ —Ä–∞–∑–≤–∏—Ç–∏—è
- –û–±—â–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏ —É—Ç–∏–ª–∏—Ç
- –£–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ CI/CD pipeline

### Gateway

* **Python FastAPI** + WebSocket

### Agent Runtime

* **Python FastAPI** + Asyncio

### LLM Proxy

* **Python FastAPI** + SSE/Streaming

### Messaging

* **IDE ‚Üî Gateway:** WebSocket (–¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π, —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
* **Gateway ‚Üî Agent:** REST + SSE –¥–ª—è streaming
* **Agent ‚Üî LLM Proxy:** REST + SSE –¥–ª—è streaming
* –§–æ—Ä–º–∞—Ç: JSON RPC style

### Streaming –ø—Ä–æ—Ç–æ–∫–æ–ª—ã

* **Agent ‚Üí Gateway ‚Üí IDE:** SSE –æ—Ç Agent –∫ Gateway, –∑–∞—Ç–µ–º WebSocket –æ—Ç Gateway –∫ IDE
* **LLM Proxy ‚Üí Agent:** SSE (Server-Sent Events)
* **–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –†–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å IDE, SSE –¥–ª—è HTTP streaming –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

### Session Storage

* In-memory (dict) –¥–ª—è POC
* Redis-ready –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è production

---

# üü¶ **8. –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ POC (1‚Äì2 –Ω–µ–¥–µ–ª–∏)**

### **–î–µ–Ω—å 1‚Äì2**

* –°–∫–µ–ª–µ—Ç Gateway WS
* –°–∫–µ–ª–µ—Ç Agent Runtime (FastAPI)
* –°–∫–µ–ª–µ—Ç LLM Proxy

### **–î–µ–Ω—å 3‚Äì4**

* Streaming –ø—Ä–æ—Ç–æ–∫–æ–ª
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ user_message ‚Üí agent_message

### **–î–µ–Ω—å 5‚Äì6**

* OpenAI function calling (tools)
* –û–±—Ä–∞–±–æ—Ç–∫–∞ tool-calls

### **–î–µ–Ω—å 7**

* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å IDE WebSocket API

### **–î–µ–Ω—å 8‚Äì10**

* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è minimal tools
* read_file
* write_file
* apply_patch
* git.diff

### **–î–µ–Ω—å 11‚Äì12**

* E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
* Debugging
* Error handling

### **–î–µ–Ω—å 13‚Äì14**

* Demo
* –ü–æ–ª–Ω–æ–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

