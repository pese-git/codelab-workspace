
# üü• **POC: AI Agent Service (Microservice Architecture)**

## –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–±–æ—á–∏–π –≤–∞—Ä–∏–∞–Ω—Ç AI Agent Service, –∫–æ—Ç–æ—Ä—ã–π:

* —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Flutter IDE —á–µ—Ä–µ–∑ Gateway (WS)
* –≤—ã–ø–æ–ª–Ω—è–µ—Ç reasoning —á–µ—Ä–µ–∑ LLM
* –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ tool-calls
* –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ IDE
* –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–π streaming
* –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

POC –¥–æ–ª–∂–µ–Ω –¥–æ–∫–∞–∑–∞—Ç—å:

* –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
* —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å latency
* –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —ç–Ω–¥-—Ç—É-—ç–Ω–¥ pipeline (User ‚Üí IDE ‚Üí Gateway ‚Üí Agent ‚Üí LLM ‚Üí Tools ‚Üí IDE)
* –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ tool-calls —á–µ—Ä–µ–∑ –∞–≥–µ–Ω—Ç–∞
* —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –æ—à–∏–±–∫–∞–º

---

# üü¶ **1. –ö–∞–∫–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –Ω—É–∂–Ω—ã –≤ POC (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ):**

–î–ª—è POC –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ **3 —Å–µ—Ä–≤–∏—Å–æ–≤**:

---

## üü© 1) **Gateway Service (WebSocket)** ‚Äî MVP-–≤–∞—Ä–∏–∞–Ω—Ç

**–ó–∞–¥–∞—á–∏:**

* –ø—Ä–∏–Ω–∏–º–∞—Ç—å WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –æ—Ç IDE
* –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è IDE ‚Üî Agent
* –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—ã–π streaming —Ç–æ–∫–µ–Ω–æ–≤
* –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ —Ç–æ–∫–µ–Ω—É (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è)

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ):**

* Node.js (Fastify + ws)
  –∏–ª–∏
* Go (fasthttp + gorilla/websocket)
  –∏–ª–∏
* Python (fastapi + gorilla/websocket)

**–ü–æ—á–µ–º—É Node/Go?**
–û–Ω–∏ –ª–µ–≥–∫–æ —Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å WS-stream –∏ –¥–∞—é—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É.

---

## üü¶ 2) **Agent Runtime Service (Core AI Logic)** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å POC

**–ó–∞–¥–∞—á–∏:**

* –ø—Ä–∏–Ω–∏–º–∞—Ç—å `user_message`
* –∑–∞–ø—É—Å–∫–∞—Ç—å LLM –∑–∞–ø—Ä–æ—Å
* —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å tool-calls (OpenAI spec)
* –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å tool-calls –≤ Gateway
* –ø–æ–ª—É—á–∞—Ç—å tool-results
* –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å reasoning
* –æ—Ç–¥–∞–≤–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ features:**

* LLM Tool Calling
* Streaming
* Multi-turn reasoning
* Error handling (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π)
* –û—Å–Ω–æ–≤–Ω—ã–µ tools:

  * read_file
  * write_file
  * git.diff
  * apply_patch

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**

**Python + FastAPI**
+
**Asyncio (–æ—á–µ–Ω—å —É–¥–æ–±–Ω–æ –¥–ª—è streaming)**

**–ü—Ä–∏—á–∏–Ω—ã:**

* –ø—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è LLM –ø—Ä–æ–∫—Å–∏
* –ø—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è JSON tool-calls
* —É–¥–æ–±–Ω–æ –¥–µ–ª–∞—Ç—å async streaming

---

## üüß 3) **LLM Proxy Service** ‚Äî POC-–≤–∞—Ä–∏–∞–Ω—Ç

**–ó–∞–¥–∞—á–∏:**

* –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –æ—Ç Agent Runtime
* –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –≤ LLM (OpenAI)
* –≤—ã–ø–ª—ë–≤—ã–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã stream –æ–±—Ä–∞—Ç–Ω–æ –∞–≥–µ–Ω—Ç—É

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**

* Python FastAPI
  –∏–ª–∏
* Go (Fiber)

**–ù—É–∂–Ω—ã –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

* streaming (event-source style)
* –ø–æ–¥–¥–µ—Ä–∂–∫–∞ OpenAI function calling

---

# üü´ **2. –ö–∞–∫–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –ù–ï –Ω—É–∂–Ω—ã –≤ POC (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ—Ç–æ–º)**

–ù–µ –Ω—É–∂–Ω—ã –Ω–∞ –ø–µ—Ä–≤–æ–π –≤–µ—Ä—Å–∏–∏:

* Patch Review Service
* Approval Service
* Telemetry Service
* Session Store (–º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø–∞–º—è—Ç–∏)
* Rate Limits
* Billing
* Multi-tenant_id

---

# üü• **3. –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ POC**

```mermaid
flowchart LR

IDE[Flutter IDE\n(Local Tools)] 
  -->|WebSocket| GW[Gateway Service]

GW -->|user_message| AGENT[Agent Runtime]
AGENT -->|LLM Request| LLM[LLM Proxy]
LLM -->|Streaming Tokens| AGENT

AGENT -->|tool_call| GW
GW -->|tool_call| IDE
IDE -->|tool_result| GW
GW --> AGENT

AGENT -->|final message| GW
GW --> IDE
```

---

# üü© **4. –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª POC**

POC –¥–æ–ª–∂–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª:

---

## üî∑ 1) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí IDE ‚Üí Gateway ‚Üí Agent

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∑–∞–ø—Ä–æ—Å:

> "–î–æ–±–∞–≤—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª auth.js"

IDE –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:

```json
{
  "type": "user_message",
  "content": "Add logging to auth.js"
}
```

---

## üî∑ 2) Agent ‚Üí LLM (Tool Calling)

–ê–≥–µ–Ω—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç –∑–∞–ø—Ä–æ—Å:

```json
{
  "model": "gpt-4o",
  "messages": [...],
  "tools": [...]
}
```

---

## üî∑ 3) LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç tool-call

–ù–∞–ø—Ä–∏–º–µ—Ä:

```json
{
  "tool": "read_file",
  "arguments": { "path": "src/auth.js" }
}
```

---

## üî∑ 4) Agent ‚Üí Gateway ‚Üí IDE (–≤—ã–ø–æ–ª–Ω–∏—Ç—å tool)

IDE –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞.

---

## üî∑ 5) Agent ‚Üí LLM (reasoning continues)

LLM –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ñ–∞–π–ª–∞ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç:

* –ø–∞—Ç—á
  –∏–ª–∏
* –Ω–æ–≤—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
  –∏–ª–∏
* —Å–ª–µ–¥—É—é—â–∏–π tool call

---

## üî∑ 6) Apply Patch

Agent –≤—ã–∑—ã–≤–∞–µ—Ç tool:

```json
{
  "tool": "apply_patch",
  "args": { "diff": "diff --git..." }
}
```

IDE –ø—Ä–∏–º–µ–Ω—è–µ—Ç –ø–∞—Ç—á.

---

## üî∑ 7) Agent –∑–∞–≤–µ—Ä—à–∞–µ—Ç –æ—Ç–≤–µ—Ç ‚Üí Gateway ‚Üí IDE

Streaming + —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç.

---

# üü¶ **5. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä Tools –¥–ª—è POC**

### 1) `read_file`

### 2) `write_file`

### 3) `git.diff`

### 4) `apply_patch`

–≠—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã:

* —á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª—ã
* –ø–∏—Å–∞—Ç—å —Ñ–∞–π–ª—ã
* –ø–æ–Ω–∏–º–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
* –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –ø–∞—Ç—á–∏

---

# üü• **6. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ POC**

### üîπ Streaming —Ç–æ–∫–µ–Ω–æ–≤

LLM Proxy ‚Üí Agent ‚Üí Gateway ‚Üí IDE

### üîπ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ tool-calling

–ù–∞ —É—Ä–æ–≤–Ω–µ OpenAI JSON —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π.

### üîπ Errors –ª–æ–≥–∏–∫–∞

–í–∏–¥–∏—Ç –æ—à–∏–±–∫—É IDE –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

### üîπ Single-session

–ù–µ –Ω—É–∂–µ–Ω multi-tenancy.

### üîπ Stateless —Å–µ—Ä–≤–µ—Ä–∞

–ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∏—Ö –ª–æ–∫–∞–ª—å–Ω–æ.

---

# üü© **7. –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π**

### Gateway

* **Node.js** (Fastify + ws)
* –∏–ª–∏ Go (gorilla/websocket)

### Agent Runtime

* **Python FastAPI + Asyncio**

### LLM Proxy

* **Python FastAPI**

### Messaging

* WebSocket JSON RPC style

### –ë–µ–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

* In-memory session state

---

# üü¶ **8. –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ POC (1‚Äì2 –Ω–µ–¥–µ–ª–∏)**

### **–î–µ–Ω—å 1‚Äì2**

* –°–∫–µ–ª–µ—Ç Gateway WS
* –°–∫–µ–ª–µ—Ç Agent Runtime (FastAPI)
* –°–∫–µ–ª–µ—Ç LLM Proxy

### **–î–µ–Ω—å 3‚Äì4**

* Streaming –ø—Ä–æ—Ç–æ–∫–æ–ª
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ user_message ‚Üí agent_message

### **–î–µ–Ω—å 5‚Äì6**

* OpenAI function calling (tools)
* –û–±—Ä–∞–±–æ—Ç–∫–∞ tool-calls

### **–î–µ–Ω—å 7**

* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å IDE WebSocket API

### **–î–µ–Ω—å 8‚Äì10**

* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è minimal tools
* read_file
* write_file
* apply_patch
* git.diff

### **–î–µ–Ω—å 11‚Äì12**

* E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
* Debugging
* Error handling

### **–î–µ–Ω—å 13‚Äì14**

* Demo
* –ü–æ–ª–Ω–æ–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

