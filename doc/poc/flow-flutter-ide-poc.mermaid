flowchart LR
User --> ChatUI[Chat Interface]
ChatUI --> ChatController[Chat Controller]
PatchUI[Patch Review UI] --> PatchController[Patch Controller]
ChatController --> WSClient[WebSocket Client]
PatchController --> LocalToolsExecutor[Local Tools Executor]
CommandPanel[Command Runner Panel] --> LocalToolsExecutor
GitPanel[Git Status Panel] --> LocalToolsExecutor
LocalToolsExecutor --> FileOps[File Operations]
LocalToolsExecutor --> GitOps[Git Executor]
LocalToolsExecutor --> CommandRunner[Run Commands]
WSClient --> GW[Gateway Service]
GW --> AI[AI Agent Service]
AI --> LLM[LLM Provider]
LLM --> AI: Stream Tokens
AI --> GW: Streaming Tokens
GW --> WSClient
WSClient --> ChatUI: Render token-by-token
AI -->|apply_patch_review tool_call| PatchController
PatchController -->|filtered_diff| AI
AI -->|run_command tool_call| CommandPanel
CommandPanel -->|command_result| AI