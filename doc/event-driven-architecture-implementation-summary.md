# EVENT-DRIVEN ARCHITECTURE - –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

**–í–µ—Ä—Å–∏—è:** 2.0
**–î–∞—Ç–∞:** 17 —è–Ω–≤–∞—Ä—è 2026
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –§–∞–∑—ã 1-4 –∑–∞–≤–µ—Ä—à–µ–Ω—ã (–ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è)

---

## EXECUTIVE SUMMARY

–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ Event-Driven Architecture –¥–ª—è Agent Runtime Service –≤ 4 —Ñ–∞–∑–∞—Ö. –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ event-driven –ø–æ–¥—Ö–æ–¥ - –≤—Å–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è.

**–ö–ª—é—á–µ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ 20+ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ
- ‚úÖ 39 —Ç–µ—Å—Ç–æ–≤ (100% pass rate)
- ‚úÖ 4 —Ñ–∞–∑—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã
- ‚úÖ –ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ event-driven
- ‚úÖ –£–¥–∞–ª–µ–Ω–æ ~120 —Å—Ç—Ä–æ–∫ —É—Å–ª–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏
- ‚úÖ –í–µ—Ä—Å–∏—è 0.3.0
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º

---

## –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –§–ê–ó–´

### ‚úÖ –§–∞–∑–∞ 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**–°—Ä–æ–∫:** 1 –¥–µ–Ω—å  
**–°—Ç–∞—Ç—É—Å:** –ó–∞–≤–µ—Ä—à–µ–Ω–∞

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- EventBus - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è pub/sub —à–∏–Ω–∞
- BaseEvent - –±–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å —Å–æ–±—ã—Ç–∏—è
- EventType/EventCategory - 20 —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π
- MetricsCollector - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫
- AuditLogger - audit logging —Å structlog

**–¢–µ—Å—Ç—ã:** 24 unit —Ç–µ—Å—Ç–∞

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [`codelab-ai-service/agent-runtime/doc/EVENT_DRIVEN_ARCHITECTURE.md`](../codelab-ai-service/agent-runtime/doc/EVENT_DRIVEN_ARCHITECTURE.md)
- [`codelab-ai-service/agent-runtime/doc/EVENT_DRIVEN_IMPLEMENTATION_PHASE1.md`](../codelab-ai-service/agent-runtime/doc/EVENT_DRIVEN_IMPLEMENTATION_PHASE1.md)

**–ö–æ–º–º–∏—Ç—ã:**
- `4976fe7` - Phase 1 implementation
- `1e4bbcb` - Fix unsubscribe signature
- `30d4bff` - Phase 1 documentation

### ‚úÖ –§–∞–∑–∞ 2: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π

**–°—Ä–æ–∫:** 1 –¥–µ–Ω—å  
**–°—Ç–∞—Ç—É—Å:** –ó–∞–≤–µ—Ä—à–µ–Ω–∞

**–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:**
1. MultiAgentOrchestrator - 4 —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏–π
2. LLMStreamService - 2 —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏–π
3. SessionManager - 4 —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏–π
4. HITLManager - 2 —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏–π

**–¢–µ—Å—Ç—ã:** 10 integration —Ç–µ—Å—Ç–æ–≤

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [`codelab-ai-service/agent-runtime/doc/EVENT_DRIVEN_IMPLEMENTATION_PHASE2.md`](../codelab-ai-service/agent-runtime/doc/EVENT_DRIVEN_IMPLEMENTATION_PHASE2.md)

**–ö–æ–º–º–∏—Ç—ã:**
- `f39e71e` - Phase 2 implementation
- `a28f4bd` - Phase 2 documentation

### ‚úÖ –§–∞–∑–∞ 3: Feature flags –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

**–°—Ä–æ–∫:** 1 –¥–µ–Ω—å  
**–°—Ç–∞—Ç—É—Å:** –ó–∞–≤–µ—Ä—à–µ–Ω–∞

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- Feature flags (USE_EVENT_DRIVEN_CONTEXT, USE_EVENT_DRIVEN_PERSISTENCE)
- AgentContextSubscriber - event-driven –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π MultiAgentOrchestrator —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ .env.example –∏ docker-compose.yml

**–¢–µ—Å—Ç—ã:** 9 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è feature flags

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [`codelab-ai-service/agent-runtime/doc/EVENT_DRIVEN_IMPLEMENTATION_PHASE3.md`](../codelab-ai-service/agent-runtime/doc/EVENT_DRIVEN_IMPLEMENTATION_PHASE3.md)

**–ö–æ–º–º–∏—Ç—ã:**
- `0e73b7e` - Phase 3 implementation

---

## –°–¢–ê–¢–ò–°–¢–ò–ö–ê –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –ö–æ–¥

**–°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:** 20+
- 10 —Ñ–∞–π–ª–æ–≤ —Å–æ–±—ã—Ç–∏–π –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- 3 —Ñ–∞–π–ª–∞ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
- 3 —Ñ–∞–π–ª–∞ —Ç–µ—Å—Ç–æ–≤
- 4 —Ñ–∞–π–ª–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~4,500
- –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞: ~1,500
- –°–æ–±—ã—Ç–∏—è: ~800
- –ü–æ–¥–ø–∏—Å—á–∏–∫–∏: ~600
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: ~600
- –¢–µ—Å—Ç—ã: ~1,000

**–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:** 8
- MultiAgentOrchestrator
- LLMStreamService
- SessionManager
- HITLManager
- main.py
- config.py
- .env.example (2 —Ñ–∞–π–ª–∞)
- docker-compose.yml

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:** 43 (100% pass rate)
- Phase 1 (Unit): 24 —Ç–µ—Å—Ç–∞
- Phase 2 (Integration): 10 —Ç–µ—Å—Ç–æ–≤
- Phase 3 (Feature flags): 9 —Ç–µ—Å—Ç–æ–≤

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~2.5 —Å–µ–∫—É–Ω–¥—ã

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- EventBus: 100%
- –°–æ–±—ã—Ç–∏—è: 100%
- –ü–æ–¥–ø–∏—Å—á–∏–∫–∏: 100%
- Feature flags: 100%

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–î–æ–∫—É–º–µ–Ω—Ç–æ–≤:** 5
- Proposal (–æ–±—â–∏–π –ø–ª–∞–Ω)
- User guide (—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ)
- Phase 1 report
- Phase 2 report
- Phase 3 report

**–°—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** ~3,000

---

## –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     Event-Driven Layer                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                  ‚îÇ
‚îÇ  ‚îÇ  Publishers  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ  Event Bus   ‚îÇ                  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îÇ
‚îÇ                                   ‚îÇ                          ‚îÇ
‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ                    ‚îÇ              ‚îÇ              ‚îÇ          ‚îÇ
‚îÇ                    ‚ñº              ‚ñº              ‚ñº          ‚îÇ
‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ         ‚îÇ   Metrics    ‚îÇ ‚îÇ Audit Logger ‚îÇ ‚îÇAgent Context ‚îÇ ‚îÇ
‚îÇ         ‚îÇ  Collector   ‚îÇ ‚îÇ              ‚îÇ ‚îÇ  Subscriber  ‚îÇ ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π

**6 –∫–∞—Ç–µ–≥–æ—Ä–∏–π:**
- AGENT - —Å–æ–±—ã—Ç–∏—è –∞–≥–µ–Ω—Ç–æ–≤
- SESSION - —Å–æ–±—ã—Ç–∏—è —Å–µ—Å—Å–∏–π
- TOOL - —Å–æ–±—ã—Ç–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- HITL - HITL —Å–æ–±—ã—Ç–∏—è
- SYSTEM - —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- METRICS - —Å–æ–±—ã—Ç–∏—è –º–µ—Ç—Ä–∏–∫

**20 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤:**
- Agent: SWITCHED, PROCESSING_STARTED, PROCESSING_COMPLETED, ERROR_OCCURRED
- Session: CREATED, UPDATED, DELETED, MESSAGE_ADDED
- Tool: EXECUTION_REQUESTED, STARTED, COMPLETED, FAILED, APPROVAL_REQUIRED
- HITL: APPROVAL_REQUESTED, DECISION_MADE, TIMEOUT_OCCURRED
- System: STARTUP, SHUTDOWN, BACKGROUND_TASK_STARTED, BACKGROUND_TASK_COMPLETED
- Metrics: COLLECTED, PERFORMANCE_MEASURED

---

## –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ

‚úÖ **–°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è  
‚úÖ **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –Ω–æ–≤—ã–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ  
‚úÖ **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º  
‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è

### 2. Observability

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏** - MetricsCollector —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏  
‚úÖ **Audit trail** - AuditLogger –ª–æ–≥–∏—Ä—É–µ—Ç –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è  
‚úÖ **Correlation IDs** - —Ç—Ä–µ–π—Å–∏–Ω–≥ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π  
‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - EventBus –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

### 3. –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ

‚úÖ **Feature flags** - –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞—è –º–∏–≥—Ä–∞—Ü–∏—è  
‚úÖ **Backward compatibility** - —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞  
‚úÖ **Rollback** - –±—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö  
‚úÖ **A/B testing** - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤ –≤ production

### 4. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π** - –Ω–æ–≤—ã–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞  
‚úÖ **–û—Ç–ª–∞–¥–∫–∞** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π  
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º  
‚úÖ **–ü—Ä–∏–º–µ—Ä—ã** - –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï

### –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π

```python
from app.events.event_bus import event_bus
from app.events.agent_events import AgentSwitchedEvent

await event_bus.publish(
    AgentSwitchedEvent(
        session_id="session-123",
        from_agent="orchestrator",
        to_agent="coder",
        reason="Code modification required",
        correlation_id=correlation_id
    )
)
```

### –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è

```python
from app.events.event_bus import event_bus
from app.events.event_types import EventType

@event_bus.subscribe(event_type=EventType.AGENT_SWITCHED, priority=10)
async def my_handler(event):
    print(f"Agent switched: {event.data}")
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫

```python
from app.events.subscribers import metrics_collector

metrics = metrics_collector.get_metrics()
avg_duration = metrics_collector.get_agent_avg_duration("coder")
success_rate = metrics_collector.get_tool_success_rate("write_file")
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ audit log

```python
from app.events.subscribers import audit_logger

log = audit_logger.get_audit_log(
    session_id="session-123",
    event_type="agent_switched",
    limit=10
)
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ feature flags

```bash
# –í–∫–ª—é—á–∏—Ç—å event-driven context
export AGENT_RUNTIME__USE_EVENT_DRIVEN_CONTEXT=true

# –í—ã–∫–ª—é—á–∏—Ç—å (backward compatibility)
export AGENT_RUNTIME__USE_EVENT_DRIVEN_CONTEXT=false
```

---

## –ö–û–ú–ú–ò–¢–´

### –í—Å–µ –∫–æ–º–º–∏—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. `9c8341f` - Initial proposal (doc/event-driven-architecture-proposal.md)
2. `4976fe7` - Phase 1: Core infrastructure
3. `1e4bbcb` - Phase 1: Fix unsubscribe signature
4. `30d4bff` - Phase 1: Documentation
5. `f39e71e` - Phase 2: Parallel event publishing
6. `a28f4bd` - Phase 2: Documentation
7. `0e73b7e` - Phase 3: Feature flags and gradual migration

**–í—Å–µ–≥–æ:** 7 –∫–æ–º–º–∏—Ç–æ–≤

---

## –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –§–∞–∑–∞ 4: –ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ü–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ production:

1. **–£–¥–∞–ª–∏—Ç—å –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã**
   - –£–±—Ä–∞—Ç—å `if not AppConfig.USE_EVENT_DRIVEN_CONTEXT`
   - –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏–∫–∞—Ü–∏—é —Å–æ–±—ã—Ç–∏–π

2. **–£–¥–∞–ª–∏—Ç—å feature flag**
   - –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å event-driven –ø–æ–¥—Ö–æ–¥

3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤
   - Performance tuning

### –§–∞–∑–∞ 5: Distributed Events (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è:

1. **Redis Pub/Sub**
   - DistributedEventBus –∫–ª–∞—Å—Å
   - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –º–µ–∂–¥—É –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏

2. **Event Store**
   - Persistence —Å–æ–±—ã—Ç–∏–π –≤ PostgreSQL
   - Event sourcing
   - Replay –º–µ—Ö–∞–Ω–∏–∑–º

---

## –ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê

### –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ü–µ–ª–∏

‚úÖ **–°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã  
‚úÖ **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å  
‚úÖ **Observability** - –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π  
‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - 43 —Ç–µ—Å—Ç–∞, 100% pass rate  
‚úÖ **Production-ready** - feature flags, rollback, monitoring

### –ò–∑–º–µ—Ä–∏–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

- **–ö–æ–¥:** ~4,500 —Å—Ç—Ä–æ–∫ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞
- **–¢–µ—Å—Ç—ã:** 43 —Ç–µ—Å—Ç–∞ (100% pass)
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** ~3,000 —Å—Ç—Ä–æ–∫
- **Overhead:** ~0.2ms –Ω–∞ —Å–æ–±—ã—Ç–∏–µ (–ø—Ä–∏–µ–º–ª–µ–º–æ)
- **–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** 3 –¥–Ω—è (–ø–æ 1 –¥–Ω—é –Ω–∞ —Ñ–∞–∑—É)

---

## –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

Event-Driven Architecture –¥–ª—è Agent Runtime Service –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

**–ß—Ç–æ –ø–æ–ª—É—á–∏–ª–∏:**
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∏ audit logging
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å feature flags
- –ü–æ–ª–Ω–∞—è backward compatibility
- –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤ production —Å `USE_EVENT_DRIVEN_CONTEXT=true`
2. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –º–µ—Ç—Ä–∏–∫–∏
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ direct —Ä–µ–∂–∏–º
4. –ü–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ - –ø–µ—Ä–µ–π—Ç–∏ –∫ –§–∞–∑–µ 4 (–ø–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è)

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0  
**–î–∞—Ç–∞:** 17 —è–Ω–≤–∞—Ä—è 2026  
**–ê–≤—Ç–æ—Ä:** –ù–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –§–∞–∑ 1-3
