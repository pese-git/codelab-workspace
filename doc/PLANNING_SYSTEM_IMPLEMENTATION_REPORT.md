# –û—Ç—á—ë—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

**–î–∞—Ç–∞:** 31 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å:** –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã  
**–ü—Ä–æ–≥—Ä–µ—Å—Å:** 3 –∏–∑ 6 —Ñ–∞–∑ –∑–∞–≤–µ—Ä—à–µ–Ω—ã (50%)

---

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è CodeLab Agent Runtime —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É –∑–∞–¥–∞–Ω–∏—é. –°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—é –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á –≤ –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–æ–π —Å—Ä–µ–¥–µ.

---

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. Task Classifier (–§–ê–ó–ê 2) ‚úÖ

**–§–∞–π–ª—ã:**
- `app/domain/entities/task_classification.py` - Pydantic –º–æ–¥–µ–ª—å
- `app/domain/services/task_classifier.py` - –°–µ—Ä–≤–∏—Å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `tests/test_task_classifier.py` - 28 unit —Ç–µ—Å—Ç–æ–≤

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- LLM-based –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (temperature=0.3 –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏)
- Keyword-based fallback –ø—Ä–∏ –æ—à–∏–±–∫–µ LLM
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª–∞: `is_atomic=false` ‚Üí `agent="plan"`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ Python boolean –≤ JSON –æ—Ç–≤–µ—Ç–∞—Ö

**–¢–µ—Å—Ç—ã:** 28/28 passed (100%)

**Commit:** `a6f8ee7`

---

### 2. Plan Repository (–§–ê–ó–ê 2) ‚úÖ

**–§–∞–π–ª—ã:**
- `app/infrastructure/persistence/models/plan.py` - SQLAlchemy –º–æ–¥–µ–ª–∏
- `app/infrastructure/persistence/mappers/plan_mapper.py` - Domain ‚Üî DB mapper
- `app/domain/repositories/plan_repository.py` - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- `app/infrastructure/persistence/repositories/plan_repository_impl.py` - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø–ª–∞–Ω–æ–≤ –≤ PostgreSQL
- Eager loading subtasks (selectin strategy)
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–ª–∞–Ω–∞–º–∏
- –ü–æ–∏—Å–∫ –ø–æ session_id –∏ status
- –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞–Ω–æ–≤ —Å–µ—Å—Å–∏–∏

**–°—Ö–µ–º–∞ –ë–î:**
```sql
CREATE TABLE plans (
    id VARCHAR(36) PRIMARY KEY,
    session_id VARCHAR(36) REFERENCES sessions(id),
    goal TEXT,
    status VARCHAR(20),
    current_subtask_id VARCHAR(36),
    metadata_json TEXT,
    approved_at TIMESTAMP,
    started_at TIMESTAMP,
    completed_at TIMESTAMP,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);

CREATE TABLE subtasks (
    id VARCHAR(36) PRIMARY KEY,
    plan_id VARCHAR(36) REFERENCES plans(id),
    description TEXT,
    agent VARCHAR(20),
    status VARCHAR(20),
    dependencies_json TEXT,
    estimated_time VARCHAR(50),
    result TEXT,
    error TEXT,
    started_at TIMESTAMP,
    completed_at TIMESTAMP,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

**Commit:** `06d7fda`

---

### 3. FSM Orchestrator (–§–ê–ó–ê 3) ‚úÖ

**–§–∞–π–ª—ã:**
- `app/domain/entities/fsm_state.py` - FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –ø—Ä–∞–≤–∏–ª–∞
- `app/domain/services/fsm_orchestrator.py` - Orchestrator —Å–µ—Ä–≤–∏—Å
- `tests/test_fsm_orchestrator.py` - 37 unit —Ç–µ—Å—Ç–æ–≤

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- 7 —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM (IDLE, CLASSIFY, PLAN_REQUIRED, ARCHITECT_PLANNING, EXECUTION, ERROR_HANDLING, COMPLETED)
- –ü–æ–ª–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- Per-session –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã —Å metadata
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–µ—Å—Å–∏–π

**–î–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π:**
```
IDLE ‚Üí CLASSIFY ‚Üí PLAN_REQUIRED ‚Üí ARCHITECT_PLANNING ‚Üí EXECUTION ‚Üí COMPLETED
                ‚Üì                                                    ‚Üì
              EXECUTION ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ERROR_HANDLING ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–¢–µ—Å—Ç—ã:** 37/37 passed (100%)

**Commit:** `4abe8a8`

---

### 4. Dependency Resolver (–§–ê–ó–ê 3) ‚úÖ

**–§–∞–π–ª—ã:**
- `app/domain/services/dependency_resolver.py` - Resolver —Å–µ—Ä–≤–∏—Å

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ—Ç–æ–≤—ã—Ö –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é subtasks
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (DFS algorithm)
- –¢–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (3 –ø—Ä–æ–≤–µ—Ä–∫–∏)
- –ê–Ω–∞–ª–∏–∑ –≤–ª–∏—è–Ω–∏—è –æ—à–∏–±–æ–∫ (get_dependent_subtasks)

**–ê–ª–≥–æ—Ä–∏—Ç–º—ã:**
- DFS –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ü–∏–∫–ª–æ–≤
- –¢–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**Commit:** `cb7d723`

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ | 13 |
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | ~4700 |
| Unit —Ç–µ—Å—Ç–æ–≤ | 65 |
| Pass rate | 100% |
| –ö–æ–º–º–∏—Ç–æ–≤ | 5 |
| –§–∞–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–æ | 3 –∏–∑ 6 |

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. Clean Architecture
- –î–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- Mappers –∏–∑–æ–ª–∏—Ä—É—é—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
- Repositories —Å–ª–µ–¥—É—é—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—É –ø—Ä–æ–µ–∫—Ç–∞

### 2. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ enforced
```python
if is_atomic == False:
    agent MUST BE "plan"  # –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –≤ Pydantic
```

### 3. –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- FSM —Å —á—ë—Ç–∫–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 4. Resilience
- Fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (keyword classification)
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ü–∏–∫–ª–æ–≤ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (MVP)

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (P0)

**1. SubtaskExecutor** (2-3 —á–∞—Å–∞)
- –ó–∞–ø—É—Å–∫ subtask –≤ —Ü–µ–ª–µ–≤–æ–º –∞–≥–µ–Ω—Ç–µ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

**2. ExecutionEngine** (4-6 —á–∞—Å–æ–≤)
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –ø–ª–∞–Ω–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ DependencyResolver
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- Progress tracking

**3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OrchestratorAgent** (6-8 —á–∞—Å–æ–≤)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ process() –º–µ—Ç–æ–¥–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è TaskClassifier
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è FSMOrchestrator
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ExecutionEngine
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

**4. API Endpoints** (4-6 —á–∞—Å–æ–≤)
- GET /sessions/{id}/plan
- POST /sessions/{id}/plan/approve
- POST /sessions/{id}/plan/cancel
- GET /sessions/{id}/plan/execution-status
- GET /sessions/{id}/plans

**–û–±—â–µ–µ –≤—Ä–µ–º—è –¥–æ MVP:** 16-23 —á–∞—Å–∞

---

## –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### ‚úÖ –ì–æ—Ç–æ–≤–æ
- TaskClassifier - –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–¥–∞—á
- Plan Repository - –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- FSM Orchestrator - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- DependencyResolver - —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### ‚è≥ –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- SubtaskExecutor
- ExecutionEngine
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OrchestratorAgent
- API endpoints

### üìã –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ
- Runtime Guards (P1)
- Validation Layer (P1)
- E2E —Ç–µ—Å—Ç—ã
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç—â–∞—Ç–µ–ª—å–Ω–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –°–ª–µ–¥—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —É—á—Ç–µ–Ω–∞

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- ‚ö†Ô∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º OrchestratorAgent –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- ‚ö†Ô∏è Performance –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ subtasks (>50)
- ‚ö†Ô∏è –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –≤ production

### –ú–∏—Ç–∏–≥–∞—Ü–∏—è
- Feature flags –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ –≤–∫–ª—é—á–µ–Ω–∏—è
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- Rollback –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –≥–æ—Ç–æ–≤–∞

---

## –í—ã–≤–æ–¥—ã

–ë–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏. –°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

1. **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - FSM —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
2. **–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—é –∑–∞–¥–∞—á** - TaskClassifier + Plan Repository
3. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏** - DependencyResolver —Å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ–º —Ü–∏–∫–ª–æ–≤
4. **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - PostgreSQL —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏

–°–ª–µ–¥—É—é—â–∏–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —à–∞–≥ - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OrchestratorAgent –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è MVP.

---

**–ê–≤—Ç–æ—Ä:** Sergey Penkovsky  
**–í–µ—Ç–∫–∞:** `feature/planning-system` –≤ `codelab-ai-service`  
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [`doc/PLANNING_SYSTEM_README.md`](PLANNING_SYSTEM_README.md)
